---
title: "historical_maturity_comparisons"
author: "Markus Min"
date: "6/28/2021"
output: html_document
---

#### Load libraries
```{r load_libraries}
library(readxl)
library(here)
library(janitor)
library(ggthemes)
library(knitr)
library(tidyverse)
library(ggpubr)
```



#### Load data
```{r load_data}
# canary rockfish
cnry_hist <- read_excel(here("data", "CNRY_O_Master.xlsx"))
cnry_hist <- clean_names(cnry_hist)
# Add column for length in cm
cnry_hist %>% 
  mutate(length_cm = round(fish_length/10, 0)) -> cnry_hist

# Remove any data points where length or macro maturity is missing
cnry_hist %>% 
  subset(!(is.na(length_cm))) %>% 
  subset(!(is.na(macro_maturity))) -> cnry_hist

# sablefish
sabl_hist <- read_excel(here("data", "SABL_O_Master.xlsx"))
sabl_hist <- clean_names(sabl_hist)

# Add column for length in cm and for maturity (binary)
sabl_hist %>% 
  mutate(length_cm = round(fish_length/10, 0)) %>% 
  mutate(macro_maturity = ifelse(maturity_agcode %in% c(1,2), 0, 1)) -> sabl_hist

# Remove any data points where length or macro maturity is missing
sabl_hist %>% 
  subset(!(is.na(length_cm))) %>% 
  subset(!(is.na(macro_maturity))) -> sabl_hist

# Set figure directory
fig_dir <- here("figures")
```

# Plot changing maturity code usage over time
Maturity code usage by ODFW port samplers has changed over time.

```{r prepare_data_for_plot}
cnry_f_spwn <- subset(cnry_hist, sample_month >= 11 | sample_month <= 3 & sex == "F")

cnry_f <- subset(cnry_hist, sex == "F")

sabl_f_spwn <- subset(sabl_hist, sample_month >= 10 | sample_month <= 2 & sex == "F")

# Reformat cnry data for plot
cnry_f_spwn %>% 
  group_by(sample_year) %>% 
  count(maturity_agcode) %>% 
  mutate(total_samples = sum(n)) %>% 
  mutate(prop = n/total_samples) %>% 
  mutate(maturity_agcode = factor(maturity_agcode, levels = c("8", "7", "6", "5", "4", "3", "2", "1"))) %>% 
  mutate(Stage = ifelse(maturity_agcode == 1, "1: Immature",
                        ifelse(maturity_agcode == 2, "2: Maturing",
                               ifelse(maturity_agcode == 3, "3: Vitellogenesis",
                                      ifelse(maturity_agcode == 4, "4: Fertilized",
                                             ifelse(maturity_agcode == 5, "5: Ripe",
                                                    ifelse(maturity_agcode == 6, "6: Spent",
                                                           ifelse(maturity_agcode == 7, "7: Resting",
                                                                  ifelse(maturity_agcode == 8, "8: Mature", maturity_agcode)))))))))-> cnry_f_mat_codes

# Reformat sabl data for plot
sabl_f_spwn %>% 
  group_by(sample_year) %>% 
  count(maturity_agcode) %>% 
  mutate(total_samples = sum(n)) %>% 
  mutate(prop = n/total_samples) %>% 
  mutate(maturity_agcode = factor(maturity_agcode, levels = c("8", "7", "6", "5", "4", "3", "2", "1"))) %>% 
  mutate(Stage = ifelse(maturity_agcode == 1, "1: Immature",
                        ifelse(maturity_agcode == 2, "2: Maturing",
                               ifelse(maturity_agcode == 3, "3: Vitellogenesis",
                                      ifelse(maturity_agcode == 4, "4: Fertilized",
                                             ifelse(maturity_agcode == 5, "5: Ripe",
                                                    ifelse(maturity_agcode == 6, "6: Spent",
                                                           ifelse(maturity_agcode == 7, "7: Resting",
                                                                  ifelse(maturity_agcode == 8, "8: Mature", maturity_agcode)))))))))-> sabl_f_mat_codes
```

```{r cnry_maturity_code_usage_barplot}
cnry_code_plot <- ggplot(cnry_f_mat_codes, aes(x = sample_year, y = n, fill = Stage))+
  geom_bar(stat = "identity")+
  scale_fill_tableau(palette = "Tableau 10")+
  xlab("Year")+
  ylab("Number of Samples")+
  theme(axis.text = element_text(size = 15),
        axis.title = element_text(size = 20),
        panel.background = element_rect(color = "black", fill = "white"),
        panel.grid = element_blank(),
        legend.title = element_text(size = 22),
        legend.text = element_text(size = 18),
        legend.position = c(0.85, 0.7),
        legend.key=element_blank())+
  scale_x_continuous(expand = c(0,0), limits = c(1979, 2019)) + 
  scale_y_continuous(expand = c(0,0), limits = c(0, 200))+
  guides(fill = guide_legend(override.aes = list(size=10)))


cnry_code_plot 

ggsave(paste0(fig_dir, "/fig4_cnry_v2.eps"), cnry_code_plot, height = 7, width = 12)
```




```{r sabl_maturity_code_usage_barplot}
sabl_code_plot <- ggplot(sabl_f_mat_codes, aes(x = sample_year, y = n, fill = Stage))+
  geom_bar(stat = "identity")+
  scale_fill_tableau(palette = "Tableau 10")+
  xlab("Year")+
  ylab("Number of Samples")+
  theme(axis.text = element_text(size = 15),
        axis.title = element_text(size = 20),
        panel.background = element_rect(color = "black", fill = "white"),
        panel.grid = element_blank(),
        legend.title = element_text(size = 22),
        legend.text = element_text(size = 18),
        legend.position = c(0.2, 0.7),
        legend.key=element_blank())+
  scale_x_continuous(expand = c(0,0), limits = c(1978, 2019)) + 
  scale_y_continuous(expand = c(0,0), limits = c(0, 450))+
  guides(fill = guide_legend(override.aes = list(size=10)))


sabl_code_plot 

ggsave(paste0(fig_dir, "/fig4_sabl_v2.eps"), sabl_code_plot, height = 7, width = 12)
```

```{r combine_sabl_cnry_for_manuscript}
fig4 <- ggarrange(cnry_code_plot, sabl_code_plot, ncol = 1, nrow = 2, labels = c("(a)", "(b)"), 
                  label.x = 0.9, label.y = 0.975, font.label = list(size = 35, face = "plain", color = "black"))

ggsave(paste0(fig_dir, "/fig4_v2.eps"), fig4, height = 14, width = 12)
```



# Subset data for sensitivity analysis

Sensitivity testing - we will subset the data in different ways to determine the sensitivity of the analysis to different data preparation approaches.

Canary rockfish:
- Subset females
- Subset spawning season: November - March

- Remove problematic codes:
  - 7 (resting) - high degree of mis-assignment
  - 8 (mature) - no way of assessing accuracy because this code is no longer used
  
Sablefish:
- Subset females
- Subset spawning season: October - February
- Remove problematic codes:
  - 7 (resting) - high degree of mis-assignment
  - 8 (mature) - no way of assessing accuracy because this code is no longer used
- Remove clearly mis-assigned fish: immature fish >= 70 cm

### Canary
```{r canary_subset_data}
### All seasons, all codes
subset(cnry_hist, sex == "F") -> cnry_f

# Subset 1980-1984
cnry_f_80_84 <- subset(cnry_f, sample_year %in% c(1980, 1981, 1982, 1983, 1984))

# Subset 1998-2003
cnry_f_98_03 <- subset(cnry_f, sample_year %in% c(1998, 1999, 2000, 2001, 2002, 2003))

# Subset 2010-2018
cnry_f_10_18 <- subset(cnry_f, sample_year %in% c(2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))


### All seasons, no 7 no 8
subset(cnry_hist, sex == "F") %>% 
  subset(., !(maturity_agcode %in% c(7, 8)))-> cnry_f_no7no8

# Subset 1980-1984
cnry_f_no7no8_80_84 <- subset(cnry_f_no7no8, sample_year %in% c(1980, 1981, 1982, 1983, 1984))

# Subset 1998-2003
cnry_f_no7no8_98_03 <- subset(cnry_f_no7no8, sample_year %in% c(1998, 1999, 2000, 2001, 2002, 2003))

# Subset 2010-2018
cnry_f_no7no8_10_18 <- subset(cnry_f_no7no8, sample_year %in% c(2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))

### Spawning season, all codes
subset(cnry_hist, sample_month >= 11 | sample_month <= 3) %>% 
  subset(., sex == "F") -> cnry_f_spwn

# Subset 1980-1984
cnry_f_spwn_80_84 <- subset(cnry_f_spwn, sample_year %in% c(1980, 1981, 1982, 1983, 1984))

# Subset 1998-2003
cnry_f_spwn_98_03 <- subset(cnry_f_spwn, sample_year %in% c(1998, 1999, 2000, 2001, 2002, 2003))

# Subset 2010-2018
cnry_f_spwn_10_18 <- subset(cnry_f_spwn, sample_year %in% c(2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))

### Spawning season, no 7 or 8
subset(cnry_hist, sample_month >= 11 | sample_month <= 3) %>% 
  subset(., sex == "F" ) %>% 
  subset(., !(maturity_agcode %in% c(7, 8))) -> cnry_f_spwn_no7no8 

# Subset 1980-1984
cnry_f_spwn_no7no8_80_84 <- subset(cnry_f_spwn_no7no8, sample_year %in% c(1980, 1981, 1982, 1983, 1984))

# Subset 1998-2003
cnry_f_spwn_no7no8_98_03 <- subset(cnry_f_spwn_no7no8, sample_year %in% c(1998, 1999, 2000, 2001, 2002, 2003))

# Subset 2010-2018
cnry_f_spwn_no7no8_10_18 <- subset(cnry_f_spwn_no7no8, sample_year %in% c(2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))
```



### Sablefish
- 1979-1982 doesn't have enough mature fish, so we can't include this in a comparison analysis
```{r sablefish_subset_data}
### All seasons, all codes, large immature fish kept
subset(sabl_hist, sex == "F") -> sabl_f

# Subset 1995-2001
sabl_f_95_01 <- subset(sabl_f, sample_year %in% c(1995, 1996, 1997, 1998, 1999, 2000, 2001))

# Subset 2007-2018
sabl_f_07_18 <- subset(sabl_f, sample_year %in% c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))

### All seasons, all codes, large immature fish (>= 70 cm) REMOVED
sabl_f_no70immature <- subset(sabl_f, !(fish_length >= 700 & maturity_agcode %in% c(1, 2)))

# Subset 1995-2001
sabl_f_no70immature_95_01 <- subset(sabl_f_no70immature, sample_year %in% c(1995, 1996, 1997, 1998, 1999, 2000, 2001))

# Subset 2007-2018
sabl_f_no70immature_07_18 <- subset(sabl_f_no70immature, sample_year %in% c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))


### Spawning season, all codes, large immature fish (>= 70 cm) REMOVED
subset(sabl_f_no70immature, sample_month >= 10 | sample_month <= 2) -> sabl_f_spwn_no70immature


# Subset 1995-2001
sabl_f_spwn_no70immature_95_01 <- subset(sabl_f_spwn_no70immature, sample_year %in% c(1995, 1996, 1997, 1998, 1999, 2000, 2001))

# Subset 2007-2018
sabl_f_spwn_no70immature_07_18 <- subset(sabl_f_spwn_no70immature, sample_year %in% c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))


### Spawning season, no 7 no 8, large immature fish (>= 70 cm) REMOVED
subset(sabl_f_no70immature, sample_month >= 10 | sample_month <= 2) %>% 
  subset(., !(maturity_agcode %in% c(7, 8))) -> sabl_f_spwn_no70immature_no7no8

# Subset 1995-2001
sabl_f_spwn_no70immature_no7no8_95_01 <- subset(sabl_f_spwn_no70immature_no7no8, sample_year %in% c(1995, 1996, 1997, 1998, 1999, 2000, 2001))

# Subset 2007-2018
sabl_f_spwn_no70immature_no7no8_07_18 <- subset(sabl_f_spwn_no70immature_no7no8, sample_year %in% c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))

### All seasons, no 7 no 8, no fish >= 70 cm that are immature
sabl_f_no70immature %>% 
  subset(., !(maturity_agcode %in% c(7, 8))) -> sabl_f_no7no8_no70immature


# Subset 1995-2001
sabl_f_no7no8_no70immature_95_01 <- subset(sabl_f_no7no8_no70immature, sample_year %in% c(1995, 1996, 1997, 1998, 1999, 2000, 2001))

# Subset 2007-2018
sabl_f_no7no8_no70immature_07_18 <- subset(sabl_f_no7no8_no70immature, sample_year %in% c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))
```



# Calculate proportion mature at each size

## Canary rockfish

#### All seasons, all codes
```{r cnry_calc_maturity_props_allseasons_allcodes}
### 1980-1984 ###

# Calculate proportion mature at each length
cnry_f_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_80_84

# count numbers of fish in each length, join
cnry_f_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_80_84, by = "length_cm") -> cnry_prop_mature_f_80_84

### 1980-1984 ###

# Calculate proportion mature at each length
cnry_f_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_98_03

# count numbers of fish in each length, join
cnry_f_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_98_03, by = "length_cm") -> cnry_prop_mature_f_98_03


### 2010-2018 ###

# Calculate proportion mature at each length
cnry_f_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_10_18

# count numbers of fish in each length, join
cnry_f_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_10_18, by = "length_cm") -> cnry_prop_mature_f_10_18
```

#### All seasons, no codes 7 or 8
```{r cnry_calc_maturity_props_allseasons_no7no8}
### 1980-1984 ###

# Calculate proportion mature at each length
cnry_f_no7no8_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_no7no8_80_84

# count numbers of fish in each length, join
cnry_f_no7no8_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_no7no8_80_84, by = "length_cm") -> cnry_prop_mature_f_no7no8_80_84

### 1998-2003 ###

# Calculate proportion mature at each length
cnry_f_no7no8_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_no7no8_98_03

# count numbers of fish in each length, join
cnry_f_no7no8_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_no7no8_98_03, by = "length_cm") -> cnry_prop_mature_f_no7no8_98_03

### 2010-2018 ###

# Calculate proportion mature at each length
cnry_f_no7no8_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_no7no8_10_18

# count numbers of fish in each length, join
cnry_f_no7no8_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_no7no8_10_18, by = "length_cm") -> cnry_prop_mature_f_no7no8_10_18
```


#### Spawning season, all codes
```{r cnry_calc_maturity_props_spwn_allcodes}
### 1980-1984 ###

# Calculate proportion mature at each length
cnry_f_spwn_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_spwn_80_84

# count numbers of fish in each length, join
cnry_f_spwn_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_spwn_80_84, by = "length_cm") -> cnry_prop_mature_f_spwn_80_84

### 1998-2003 ###

# Calculate proportion mature at each length
cnry_f_spwn_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_spwn_98_03

# count numbers of fish in each length, join
cnry_f_spwn_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_spwn_98_03, by = "length_cm") -> cnry_prop_mature_f_spwn_98_03

### 2010-2018 ###

# Calculate proportion mature at each length
cnry_f_spwn_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_spwn_10_18

# count numbers of fish in each length, join
cnry_f_spwn_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_spwn_10_18, by = "length_cm") -> cnry_prop_mature_f_spwn_10_18
```


#### Spawning season, no codes 7 or 8
```{r cnry_calc_maturity_props_spwn_no7no8}
### 1980-1984 ###

# Calculate proportion mature at each length
cnry_f_spwn_no7no8_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_spwn_no7no8_80_84

# count numbers of fish in each length, join
cnry_f_spwn_no7no8_80_84 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_spwn_no7no8_80_84, by = "length_cm") -> cnry_prop_mature_f_spwn_no7no8_80_84

### 1998-2003 ###

# Calculate proportion mature at each length
cnry_f_spwn_no7no8_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_spwn_no7no8_98_03

# count numbers of fish in each length, join
cnry_f_spwn_no7no8_98_03 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_spwn_no7no8_98_03, by = "length_cm") -> cnry_prop_mature_f_spwn_no7no8_98_03

### 2010-2018 ###

# Calculate proportion mature at each length
cnry_f_spwn_no7no8_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> cnry_prop_mature_f_spwn_no7no8_10_18

# count numbers of fish in each length, join
cnry_f_spwn_no7no8_10_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., cnry_prop_mature_f_spwn_no7no8_10_18, by = "length_cm") -> cnry_prop_mature_f_spwn_no7no8_10_18
```


## Sablefish

#### All seasons, all codes, all length immature fish
```{r sabl_calc_maturity_props_allseasons_allcodes_allfish}

### 1995-2001 ###

# Calculate proportion mature at each length
sabl_f_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_95_01

# count numbers of fish in each length, join
sabl_f_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_95_01, by = "length_cm") -> sabl_prop_mature_f_95_01

### 2007-2018 ###

# Calculate proportion mature at each length
sabl_f_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_07_18

# count numbers of fish in each length, join
sabl_f_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_07_18, by = "length_cm") -> sabl_prop_mature_f_07_18

```

#### All seasons, all codes, no immature fish >= 70 cm
```{r sabl_calc_maturity_props_allseasons_allcodes_no70immature}

### 1995-2001 ###

# Calculate proportion mature at each length
sabl_f_no70immature_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_no70immature_95_01

# count numbers of fish in each length, join
sabl_f_no70immature_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_no70immature_95_01, by = "length_cm") -> sabl_prop_mature_f_no70immature_95_01

### 2007-2018 ###

# Calculate proportion mature at each length
sabl_f_no70immature_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_no70immature_07_18

# count numbers of fish in each length, join
sabl_f_no70immature_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_no70immature_07_18, by = "length_cm") -> sabl_prop_mature_f_no70immature_07_18

```

#### All seasons, no 7 no 8, no immature fish >= 70 cm
```{r sabl_calc_maturity_props_allseasons_allcodes_no7no8_no70immature}

### 1995-2001 ###

# Calculate proportion mature at each length
sabl_f_no7no8_no70immature_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_no7no8_no70immature_95_01

# count numbers of fish in each length, join
sabl_f_no7no8_no70immature_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_no7no8_no70immature_95_01, by = "length_cm") -> sabl_prop_mature_f_no7no8_no70immature_95_01

### 2007-2018 ###

# Calculate proportion mature at each length
sabl_f_no7no8_no70immature_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_no7no8_no70immature_07_18

# count numbers of fish in each length, join
sabl_f_no7no8_no70immature_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_no7no8_no70immature_07_18, by = "length_cm") -> sabl_prop_mature_f_no7no8_no70immature_07_18

```


#### Spawning season, all codes, no fish >= 70 cm that are immature
```{r sabl_calc_maturity_props_allcodes_no70immature}
### 1995-2001 ###

# Calculate proportion mature at each length
sabl_f_spwn_no70immature_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_spwn_no70immature_95_01

# count numbers of fish in each length, join
sabl_f_spwn_no70immature_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_spwn_no70immature_95_01, by = "length_cm") -> sabl_prop_mature_f_spwn_no70immature_95_01

### 2007-2018 ###

# Calculate proportion mature at each length
sabl_f_spwn_no70immature_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_spwn_no70immature_07_18

# count numbers of fish in each length, join
sabl_f_spwn_no70immature_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_spwn_no70immature_07_18, by = "length_cm") -> sabl_prop_mature_f_spwn_no70immature_07_18
```

#### Spawning season, no 7 no 8, no fish >= 70 cm that are immature
```{r sabl_calc_maturity_props_no70immature_no7no8}
### 1995-2001 ###

# Calculate proportion mature at each length
sabl_f_spwn_no70immature_no7no8_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_spwn_no70immature_no7no8_95_01

# count numbers of fish in each length, join
sabl_f_spwn_no70immature_no7no8_95_01 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_spwn_no70immature_no7no8_95_01, by = "length_cm") -> sabl_prop_mature_f_spwn_no70immature_no7no8_95_01

### 2007-2018 ###

# Calculate proportion mature at each length
sabl_f_spwn_no70immature_no7no8_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  summarise(prop_mature = mean(macro_maturity)) -> sabl_prop_mature_f_spwn_no70immature_no7no8_07_18

# count numbers of fish in each length, join
sabl_f_spwn_no70immature_no7no8_07_18 %>% 
  mutate(length_cm = round(fish_length/10,0)) %>% 
  group_by(length_cm) %>% 
  count(spid) %>% 
  dplyr::select(-spid) %>% 
  right_join(., sabl_prop_mature_f_spwn_no70immature_no7no8_07_18, by = "length_cm") -> sabl_prop_mature_f_spwn_no70immature_no7no8_07_18
```


# Fit GLM

## Canary rockfish

### All seasons, all maturity codes
```{r fit_glm_cnry_allseasons_allcodes}
### 1980-1984 ###

fit.mat.glm.cnry_80_84 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_80_84$length_cm, maturity <- cnry_f_80_84$macro_maturity),
                                   family = binomial(link ="logit"))
vector.cnry_80_84 = c(fit.mat.glm.cnry_80_84$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_80_84 <- vector.cnry_80_84[1] 
B_glm.cnry_80_84 <- vector.cnry_80_84[2]
Lmat50.cnry_80_84 = -(A_glm.cnry_80_84/B_glm.cnry_80_84)
Lmat50.cnry_80_84

cor(cnry_f_80_84$length_cm, cnry_f_80_84$macro_maturity)

sA.cnry_80_84 <- summary (fit.mat.glm.cnry_80_84)$coef[1,2] 
sB.cnry_80_84 <- summary (fit.mat.glm.cnry_80_84)$coef[2,2]    
r.cnry_80_84 <-cor(cnry_f_80_84$length_cm, cnry_f_80_84$macro_maturity)
n.1 <- length(cnry_f_80_84$length_cm)

#Variance estimator
deltamethod.cnry_80_84 <- ((sA.cnry_80_84^2)/(B_glm.cnry_80_84^2))- ((2*A_glm.cnry_80_84*sA.cnry_80_84*sB.cnry_80_84*r.cnry_80_84)/(B_glm.cnry_80_84^3))+ (((A_glm.cnry_80_84^2)*(sB.cnry_80_84^2))/(B_glm.cnry_80_84^4))
deltamethod.cnry_80_84

## 95% Confidence Interval equation

con.cnry_80_84 <- 1.96*(sqrt(deltamethod.cnry_80_84)/sqrt(n.1))
cnry_80_84_mat = c(Lmat50.cnry_80_84,con.cnry_80_84)

### 1998-2003 ###

fit.mat.glm.cnry_98_03 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_98_03$length_cm, maturity <- cnry_f_98_03$macro_maturity),
                              family = binomial(link ="logit"))
vector.cnry_98_03 = c(fit.mat.glm.cnry_98_03$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_98_03 <- vector.cnry_98_03[1] 
B_glm.cnry_98_03 <- vector.cnry_98_03[2]
Lmat50.cnry_98_03 = -(A_glm.cnry_98_03/B_glm.cnry_98_03)
Lmat50.cnry_98_03

cor(cnry_f_98_03$length_cm, cnry_f_98_03$macro_maturity)

sA.cnry_98_03 <- summary (fit.mat.glm.cnry_98_03)$coef[1,2] 
sB.cnry_98_03 <- summary (fit.mat.glm.cnry_98_03)$coef[2,2]    
r.cnry_98_03 <-cor(cnry_f_98_03$length_cm, cnry_f_98_03$macro_maturity)
n.1 <- length(cnry_f_98_03$length_cm)

#Variance estimator
deltamethod.cnry_98_03 <- ((sA.cnry_98_03^2)/(B_glm.cnry_98_03^2))- ((2*A_glm.cnry_98_03*sA.cnry_98_03*sB.cnry_98_03*r.cnry_98_03)/(B_glm.cnry_98_03^3))+ (((A_glm.cnry_98_03^2)*(sB.cnry_98_03^2))/(B_glm.cnry_98_03^4))
deltamethod.cnry_98_03

## 95% Confidence Interval equation

con.cnry_98_03 <- 1.96*(sqrt(deltamethod.cnry_98_03)/sqrt(n.1))
cnry_98_03_mat = c(Lmat50.cnry_98_03,con.cnry_98_03)


### 2010-2018 ###

fit.mat.glm.cnry_10_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_10_18$length_cm, maturity <- cnry_f_10_18$macro_maturity),
                                   family = binomial(link ="logit"))
vector.cnry_10_18 = c(fit.mat.glm.cnry_10_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_10_18 <- vector.cnry_10_18[1] 
B_glm.cnry_10_18 <- vector.cnry_10_18[2]
Lmat50.cnry_10_18 = -(A_glm.cnry_10_18/B_glm.cnry_10_18)
Lmat50.cnry_10_18

cor(cnry_f_10_18$length_cm, cnry_f_10_18$macro_maturity)

sA.cnry_10_18 <- summary (fit.mat.glm.cnry_10_18)$coef[1,2] 
sB.cnry_10_18 <- summary (fit.mat.glm.cnry_10_18)$coef[2,2]    
r.cnry_10_18 <- cor(cnry_f_10_18$length_cm, cnry_f_10_18$macro_maturity)
n.1 <- length(cnry_f_10_18$length_cm)

#Variance estimator
deltamethod.cnry_10_18 <- ((sA.cnry_10_18^2)/(B_glm.cnry_10_18^2))- ((2*A_glm.cnry_10_18*sA.cnry_10_18*sB.cnry_10_18*r.cnry_10_18)/(B_glm.cnry_10_18^3))+ (((A_glm.cnry_10_18^2)*(sB.cnry_10_18^2))/(B_glm.cnry_10_18^4))
deltamethod.cnry_10_18

## 95% Confidence Interval equation

con.cnry_10_18 <- 1.96*(sqrt(deltamethod.cnry_10_18)/sqrt(n.1))
cnry_10_18_mat = c(Lmat50.cnry_10_18,con.cnry_10_18)
```



### All seasons, no 7 or 8 codes
```{r fit_glm_cnry_all seasons_no7no8}
### 1980-1984 ###

fit.mat.glm.cnry_no7no8_80_84 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_no7no8_80_84$length_cm, maturity <- cnry_f_no7no8_80_84$macro_maturity),
                                          family = binomial(link ="logit"))
vector.cnry_no7no8_80_84 = c(fit.mat.glm.cnry_no7no8_80_84$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_no7no8_80_84 <- vector.cnry_no7no8_80_84[1] 
B_glm.cnry_no7no8_80_84 <- vector.cnry_no7no8_80_84[2]
Lmat50.cnry_no7no8_80_84 = -(A_glm.cnry_no7no8_80_84/B_glm.cnry_no7no8_80_84)
Lmat50.cnry_no7no8_80_84

cor(cnry_f_no7no8_80_84$length_cm, cnry_f_no7no8_80_84$macro_maturity)

sA.cnry_no7no8_80_84 <- summary (fit.mat.glm.cnry_no7no8_80_84)$coef[1,2] 
sB.cnry_no7no8_80_84 <- summary (fit.mat.glm.cnry_no7no8_80_84)$coef[2,2]    
r.cnry_no7no8_80_84 <-cor(cnry_f_no7no8_80_84$length_cm, cnry_f_no7no8_80_84$macro_maturity)
n.1 <- length(cnry_f_no7no8_80_84$length_cm)

#Variance estimator
deltamethod.cnry_no7no8_80_84 <- ((sA.cnry_no7no8_80_84^2)/(B_glm.cnry_no7no8_80_84^2))- ((2*A_glm.cnry_no7no8_80_84*sA.cnry_no7no8_80_84*sB.cnry_no7no8_80_84*r.cnry_no7no8_80_84)/(B_glm.cnry_no7no8_80_84^3))+ (((A_glm.cnry_no7no8_80_84^2)*(sB.cnry_no7no8_80_84^2))/(B_glm.cnry_no7no8_80_84^4))
deltamethod.cnry_no7no8_80_84

## 95% Confidence Interval equation

con.cnry_no7no8_80_84 <- 1.96*(sqrt(deltamethod.cnry_no7no8_80_84)/sqrt(n.1))
cnry_no7no8_80_84_mat = c(Lmat50.cnry_no7no8_80_84,con.cnry_no7no8_80_84)

### 1998-2003 ###

fit.mat.glm.cnry_no7no8_98_03 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_no7no8_98_03$length_cm, maturity <- cnry_f_no7no8_98_03$macro_maturity),
                                     family = binomial(link ="logit"))
vector.cnry_no7no8_98_03 = c(fit.mat.glm.cnry_no7no8_98_03$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_no7no8_98_03 <- vector.cnry_no7no8_98_03[1]
B_glm.cnry_no7no8_98_03 <- vector.cnry_no7no8_98_03[2]
Lmat50.cnry_no7no8_98_03 = -(A_glm.cnry_no7no8_98_03/B_glm.cnry_no7no8_98_03)
Lmat50.cnry_no7no8_98_03

cor(cnry_f_no7no8_98_03$length_cm, cnry_f_no7no8_98_03$macro_maturity)

sA.cnry_no7no8_98_03 <- summary (fit.mat.glm.cnry_no7no8_98_03)$coef[1,2] 
sB.cnry_no7no8_98_03 <- summary (fit.mat.glm.cnry_no7no8_98_03)$coef[2,2]    
r.cnry_no7no8_98_03 <-cor(cnry_f_no7no8_98_03$length_cm, cnry_f_no7no8_98_03$macro_maturity)
n.1 <- length(cnry_f_no7no8_98_03$length_cm)

#Variance estimator
deltamethod.cnry_no7no8_98_03 <- ((sA.cnry_no7no8_98_03^2)/(B_glm.cnry_no7no8_98_03^2))- ((2*A_glm.cnry_no7no8_98_03*sA.cnry_no7no8_98_03*sB.cnry_no7no8_98_03*r.cnry_no7no8_98_03)/(B_glm.cnry_no7no8_98_03^3))+ (((A_glm.cnry_no7no8_98_03^2)*(sB.cnry_no7no8_98_03^2))/(B_glm.cnry_no7no8_98_03^4))
deltamethod.cnry_no7no8_98_03

## 95% Confidence Interval equation

con.cnry_no7no8_98_03 <- 1.96*(sqrt(deltamethod.cnry_no7no8_98_03)/sqrt(n.1))
cnry_no7no8_98_03_mat = c(Lmat50.cnry_no7no8_98_03,con.cnry_no7no8_98_03)


### 2010-2018 ###

fit.mat.glm.cnry_no7no8_10_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_no7no8_10_18$length_cm, maturity <- cnry_f_no7no8_10_18$macro_maturity),
                                          family = binomial(link ="logit"))
vector.cnry_no7no8_10_18 <- c(fit.mat.glm.cnry_no7no8_10_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_no7no8_10_18 <- vector.cnry_no7no8_10_18[1] 
B_glm.cnry_no7no8_10_18 <- vector.cnry_no7no8_10_18[2]
Lmat50.cnry_no7no8_10_18 = -(A_glm.cnry_no7no8_10_18/B_glm.cnry_no7no8_10_18)
Lmat50.cnry_no7no8_10_18

cor(cnry_f_no7no8_10_18$length_cm, cnry_f_no7no8_10_18$macro_maturity)

sA.cnry_no7no8_10_18 <- summary (fit.mat.glm.cnry_no7no8_10_18)$coef[1,2] 
sB.cnry_no7no8_10_18 <- summary (fit.mat.glm.cnry_no7no8_10_18)$coef[2,2]    
r.cnry_no7no8_10_18 <-cor(cnry_f_no7no8_10_18$length_cm, cnry_f_no7no8_10_18$macro_maturity)
n.1 <- length(cnry_f_no7no8_10_18$length_cm)

#Variance estimator
deltamethod.cnry_no7no8_10_18 <- ((sA.cnry_no7no8_10_18^2)/(B_glm.cnry_no7no8_10_18^2))- ((2*A_glm.cnry_no7no8_10_18*sA.cnry_no7no8_10_18*sB.cnry_no7no8_10_18*r.cnry_no7no8_10_18)/(B_glm.cnry_no7no8_10_18^3))+ (((A_glm.cnry_no7no8_10_18^2)*(sB.cnry_no7no8_10_18^2))/(B_glm.cnry_no7no8_10_18^4))
deltamethod.cnry_no7no8_10_18

## 95% Confidence Interval equation

con.cnry_no7no8_10_18 <- 1.96*(sqrt(deltamethod.cnry_no7no8_10_18)/sqrt(n.1))
cnry_no7no8_10_18_mat <- c(Lmat50.cnry_no7no8_10_18,con.cnry_no7no8_10_18)
```





### Spawning season, all maturity codes
```{r fit_glm_cnry_allcodes}
### 1980-1984 ###

fit.mat.glm.cnry_spwn_80_84 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_spwn_80_84$length_cm, maturity <- cnry_f_spwn_80_84$macro_maturity),
                            family = binomial(link ="logit"))
vector.cnry_spwn_80_84 = c(fit.mat.glm.cnry_spwn_80_84$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_spwn_80_84 <- vector.cnry_spwn_80_84[1] 
B_glm.cnry_spwn_80_84 <- vector.cnry_spwn_80_84[2]
Lmat50.cnry_spwn_80_84 = -(A_glm.cnry_spwn_80_84/B_glm.cnry_spwn_80_84)
Lmat50.cnry_spwn_80_84

cor(cnry_f_spwn_80_84$length_cm, cnry_f_spwn_80_84$macro_maturity)

sA.cnry_spwn_80_84 <- summary (fit.mat.glm.cnry_spwn_80_84)$coef[1,2] 
sB.cnry_spwn_80_84 <- summary (fit.mat.glm.cnry_spwn_80_84)$coef[2,2]    
r.cnry_spwn_80_84 <-cor(cnry_f_spwn_80_84$length_cm, cnry_f_spwn_80_84$macro_maturity)
n.1 <- length(cnry_f_spwn_80_84$length_cm)

#Variance estimator
deltamethod.cnry_spwn_80_84 <- ((sA.cnry_spwn_80_84^2)/(B_glm.cnry_spwn_80_84^2))- ((2*A_glm.cnry_spwn_80_84*sA.cnry_spwn_80_84*sB.cnry_spwn_80_84*r.cnry_spwn_80_84)/(B_glm.cnry_spwn_80_84^3))+ (((A_glm.cnry_spwn_80_84^2)*(sB.cnry_spwn_80_84^2))/(B_glm.cnry_spwn_80_84^4))
deltamethod.cnry_spwn_80_84

## 95% Confidence Interval equation

con.cnry_spwn_80_84 <- 1.96*(sqrt(deltamethod.cnry_spwn_80_84)/sqrt(n.1))
cnry_spwn_80_84_mat = c(Lmat50.cnry_spwn_80_84,con.cnry_spwn_80_84)

### 1998-2003 ###

fit.mat.glm.cnry_spwn_98_03 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_spwn_98_03$length_cm, maturity <- cnry_f_spwn_98_03$macro_maturity),
                                   family = binomial(link ="logit"))
vector.cnry_spwn_98_03 = c(fit.mat.glm.cnry_spwn_98_03$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_spwn_98_03 <- vector.cnry_spwn_98_03[1] 
B_glm.cnry_spwn_98_03 <- vector.cnry_spwn_98_03[2]
Lmat50.cnry_spwn_98_03 = -(A_glm.cnry_spwn_98_03/B_glm.cnry_spwn_98_03)
Lmat50.cnry_spwn_98_03

cor(cnry_f_spwn_98_03$length_cm, cnry_f_spwn_98_03$macro_maturity)

sA.cnry_spwn_98_03 <- summary (fit.mat.glm.cnry_spwn_98_03)$coef[1,2] 
sB.cnry_spwn_98_03 <- summary (fit.mat.glm.cnry_spwn_98_03)$coef[2,2]    
r.cnry_spwn_98_03 <-cor(cnry_f_spwn_98_03$length_cm, cnry_f_spwn_98_03$macro_maturity)
n.1 <- length(cnry_f_spwn_98_03$length_cm)

#Variance estimator
deltamethod.cnry_spwn_98_03 <- ((sA.cnry_spwn_98_03^2)/(B_glm.cnry_spwn_98_03^2))- ((2*A_glm.cnry_spwn_98_03*sA.cnry_spwn_98_03*sB.cnry_spwn_98_03*r.cnry_spwn_98_03)/(B_glm.cnry_spwn_98_03^3))+ (((A_glm.cnry_spwn_98_03^2)*(sB.cnry_spwn_98_03^2))/(B_glm.cnry_spwn_98_03^4))
deltamethod.cnry_spwn_98_03

## 95% Confidence Interval equation

con.cnry_spwn_98_03 <- 1.96*(sqrt(deltamethod.cnry_spwn_98_03)/sqrt(n.1))
cnry_spwn_98_03_mat = c(Lmat50.cnry_spwn_98_03,con.cnry_spwn_98_03)


### 2010-2018 ###

fit.mat.glm.cnry_spwn_10_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_spwn_10_18$length_cm, maturity <- cnry_f_spwn_10_18$macro_maturity),
                                   family = binomial(link ="logit"))
vector.cnry_spwn_10_18 = c(fit.mat.glm.cnry_spwn_10_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_spwn_10_18 <- vector.cnry_spwn_10_18[1] 
B_glm.cnry_spwn_10_18 <- vector.cnry_spwn_10_18[2]
Lmat50.cnry_spwn_10_18 = -(A_glm.cnry_spwn_10_18/B_glm.cnry_spwn_10_18)
Lmat50.cnry_spwn_10_18

cor(cnry_f_spwn_10_18$length_cm, cnry_f_spwn_10_18$macro_maturity)

sA.cnry_spwn_10_18 <- summary (fit.mat.glm.cnry_spwn_10_18)$coef[1,2] 
sB.cnry_spwn_10_18 <- summary (fit.mat.glm.cnry_spwn_10_18)$coef[2,2]    
r.cnry_spwn_10_18 <-cor(cnry_f_spwn_10_18$length_cm, cnry_f_spwn_10_18$macro_maturity)
n.1 <- length(cnry_f_spwn_10_18$length_cm)

#Variance estimator
deltamethod.cnry_spwn_10_18 <- ((sA.cnry_spwn_10_18^2)/(B_glm.cnry_spwn_10_18^2))- ((2*A_glm.cnry_spwn_10_18*sA.cnry_spwn_10_18*sB.cnry_spwn_10_18*r.cnry_spwn_10_18)/(B_glm.cnry_spwn_10_18^3))+ (((A_glm.cnry_spwn_10_18^2)*(sB.cnry_spwn_10_18^2))/(B_glm.cnry_spwn_10_18^4))
deltamethod.cnry_spwn_10_18

## 95% Confidence Interval equation

con.cnry_spwn_10_18 <- 1.96*(sqrt(deltamethod.cnry_spwn_10_18)/sqrt(n.1))
cnry_spwn_10_18_mat = c(Lmat50.cnry_spwn_10_18,con.cnry_spwn_10_18)
```



### Spawning season, no 7 or 8 codes
```{r fit_glm_cnry_allcodes}
### 1980-1984 ###

fit.mat.glm.cnry_spwn_no7no8_80_84 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_spwn_no7no8_80_84$length_cm, maturity <- cnry_f_spwn_no7no8_80_84$macro_maturity),
                                   family = binomial(link ="logit"))
vector.cnry_spwn_no7no8_80_84 = c(fit.mat.glm.cnry_spwn_no7no8_80_84$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_spwn_no7no8_80_84 <- vector.cnry_spwn_no7no8_80_84[1] 
B_glm.cnry_spwn_no7no8_80_84 <- vector.cnry_spwn_no7no8_80_84[2]
Lmat50.cnry_spwn_no7no8_80_84 = -(A_glm.cnry_spwn_no7no8_80_84/B_glm.cnry_spwn_no7no8_80_84)
Lmat50.cnry_spwn_no7no8_80_84

cor(cnry_f_spwn_no7no8_80_84$length_cm, cnry_f_spwn_no7no8_80_84$macro_maturity)

sA.cnry_spwn_no7no8_80_84 <- summary (fit.mat.glm.cnry_spwn_no7no8_80_84)$coef[1,2] 
sB.cnry_spwn_no7no8_80_84 <- summary (fit.mat.glm.cnry_spwn_no7no8_80_84)$coef[2,2]    
r.cnry_spwn_no7no8_80_84 <-cor(cnry_f_spwn_no7no8_80_84$length_cm, cnry_f_spwn_no7no8_80_84$macro_maturity)
n.1 <- length(cnry_f_spwn_no7no8_80_84$length_cm)

#Variance estimator
deltamethod.cnry_spwn_no7no8_80_84 <- ((sA.cnry_spwn_no7no8_80_84^2)/(B_glm.cnry_spwn_no7no8_80_84^2))- ((2*A_glm.cnry_spwn_no7no8_80_84*sA.cnry_spwn_no7no8_80_84*sB.cnry_spwn_no7no8_80_84*r.cnry_spwn_no7no8_80_84)/(B_glm.cnry_spwn_no7no8_80_84^3))+ (((A_glm.cnry_spwn_no7no8_80_84^2)*(sB.cnry_spwn_no7no8_80_84^2))/(B_glm.cnry_spwn_no7no8_80_84^4))
deltamethod.cnry_spwn_no7no8_80_84

## 95% Confidence Interval equation

con.cnry_spwn_no7no8_80_84 <- 1.96*(sqrt(deltamethod.cnry_spwn_no7no8_80_84)/sqrt(n.1))
cnry_spwn_no7no8_80_84_mat = c(Lmat50.cnry_spwn_no7no8_80_84,con.cnry_spwn_no7no8_80_84)

### 1998-2003 ###

fit.mat.glm.cnry_spwn_no7no8_98_03 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_spwn_no7no8_98_03$length_cm, maturity <- cnry_f_spwn_no7no8_98_03$macro_maturity),
                                          family = binomial(link ="logit"))
vector.cnry_spwn_no7no8_98_03 = c(fit.mat.glm.cnry_spwn_no7no8_98_03$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_spwn_no7no8_98_03 <- vector.cnry_spwn_no7no8_98_03[1] 
B_glm.cnry_spwn_no7no8_98_03 <- vector.cnry_spwn_no7no8_98_03[2]
Lmat50.cnry_spwn_no7no8_98_03 = -(A_glm.cnry_spwn_no7no8_98_03/B_glm.cnry_spwn_no7no8_98_03)
Lmat50.cnry_spwn_no7no8_98_03

cor(cnry_f_spwn_no7no8_98_03$length_cm, cnry_f_spwn_no7no8_98_03$macro_maturity)

sA.cnry_spwn_no7no8_98_03 <- summary (fit.mat.glm.cnry_spwn_no7no8_98_03)$coef[1,2] 
sB.cnry_spwn_no7no8_98_03 <- summary (fit.mat.glm.cnry_spwn_no7no8_98_03)$coef[2,2]    
r.cnry_spwn_no7no8_98_03 <-cor(cnry_f_spwn_no7no8_98_03$length_cm, cnry_f_spwn_no7no8_98_03$macro_maturity)
n.1 <- length(cnry_f_spwn_no7no8_98_03$length_cm)

#Variance estimator
deltamethod.cnry_spwn_no7no8_98_03 <- ((sA.cnry_spwn_no7no8_98_03^2)/(B_glm.cnry_spwn_no7no8_98_03^2))- ((2*A_glm.cnry_spwn_no7no8_98_03*sA.cnry_spwn_no7no8_98_03*sB.cnry_spwn_no7no8_98_03*r.cnry_spwn_no7no8_98_03)/(B_glm.cnry_spwn_no7no8_98_03^3))+ (((A_glm.cnry_spwn_no7no8_98_03^2)*(sB.cnry_spwn_no7no8_98_03^2))/(B_glm.cnry_spwn_no7no8_98_03^4))
deltamethod.cnry_spwn_no7no8_98_03

## 95% Confidence Interval equation

con.cnry_spwn_no7no8_98_03 <- 1.96*(sqrt(deltamethod.cnry_spwn_no7no8_98_03)/sqrt(n.1))
cnry_spwn_no7no8_98_03_mat = c(Lmat50.cnry_spwn_no7no8_98_03,con.cnry_spwn_no7no8_98_03)


### 2010-2018 ###

fit.mat.glm.cnry_spwn_no7no8_10_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = cnry_f_spwn_no7no8_10_18$length_cm, maturity <- cnry_f_spwn_no7no8_10_18$macro_maturity),
                                   family = binomial(link ="logit"))
vector.cnry_spwn_no7no8_10_18 <- c(fit.mat.glm.cnry_spwn_no7no8_10_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.cnry_spwn_no7no8_10_18 <- vector.cnry_spwn_no7no8_10_18[1] 
B_glm.cnry_spwn_no7no8_10_18 <- vector.cnry_spwn_no7no8_10_18[2]
Lmat50.cnry_spwn_no7no8_10_18 = -(A_glm.cnry_spwn_no7no8_10_18/B_glm.cnry_spwn_no7no8_10_18)
Lmat50.cnry_spwn_no7no8_10_18

cor(cnry_f_spwn_no7no8_10_18$length_cm, cnry_f_spwn_no7no8_10_18$macro_maturity)

sA.cnry_spwn_no7no8_10_18 <- summary (fit.mat.glm.cnry_spwn_no7no8_10_18)$coef[1,2] 
sB.cnry_spwn_no7no8_10_18 <- summary (fit.mat.glm.cnry_spwn_no7no8_10_18)$coef[2,2]    
r.cnry_spwn_no7no8_10_18 <-cor(cnry_f_spwn_no7no8_10_18$length_cm, cnry_f_spwn_no7no8_10_18$macro_maturity)
n.1 <- length(cnry_f_spwn_no7no8_10_18$length_cm)

#Variance estimator
deltamethod.cnry_spwn_no7no8_10_18 <- ((sA.cnry_spwn_no7no8_10_18^2)/(B_glm.cnry_spwn_no7no8_10_18^2))- ((2*A_glm.cnry_spwn_no7no8_10_18*sA.cnry_spwn_no7no8_10_18*sB.cnry_spwn_no7no8_10_18*r.cnry_spwn_no7no8_10_18)/(B_glm.cnry_spwn_no7no8_10_18^3))+ (((A_glm.cnry_spwn_no7no8_10_18^2)*(sB.cnry_spwn_no7no8_10_18^2))/(B_glm.cnry_spwn_no7no8_10_18^4))
deltamethod.cnry_spwn_no7no8_10_18

## 95% Confidence Interval equation

con.cnry_spwn_no7no8_10_18 <- 1.96*(sqrt(deltamethod.cnry_spwn_no7no8_10_18)/sqrt(n.1))
cnry_spwn_no7no8_10_18_mat <- c(Lmat50.cnry_spwn_no7no8_10_18,con.cnry_spwn_no7no8_10_18)
```





## Sablefish

### All seasons, all codes, all length immature fish
```{r fit_glm_sabl_allseasons_allcodes_allfish}

### 1995-2001 ###

fit.mat.glm.sabl_f_95_01 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_95_01$length_cm, maturity <- sabl_f_95_01$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_f_95_01 = c(fit.mat.glm.sabl_f_95_01$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_f_95_01 <- vector.sabl_f_95_01[1] 
B_glm.sabl_f_95_01 <- vector.sabl_f_95_01[2]
Lmat50.sabl_f_95_01 = -(A_glm.sabl_f_95_01/B_glm.sabl_f_95_01)
Lmat50.sabl_f_95_01

cor(sabl_f_95_01$length_cm, sabl_f_95_01$macro_maturity)

sA.sabl_f_95_01 <- summary (fit.mat.glm.sabl_f_95_01)$coef[1,2] 
sB.sabl_f_95_01 <- summary (fit.mat.glm.sabl_f_95_01)$coef[2,2]    
r.sabl_f_95_01 <-cor(sabl_f_95_01$length_cm, sabl_f_95_01$macro_maturity)
n.1 <- length(sabl_f_95_01$length_cm)

#Variance estimator
deltamethod.sabl_f_95_01 <- ((sA.sabl_f_95_01^2)/(B_glm.sabl_f_95_01^2))- ((2*A_glm.sabl_f_95_01*sA.sabl_f_95_01*sB.sabl_f_95_01*r.sabl_f_95_01)/(B_glm.sabl_f_95_01^3))+ (((A_glm.sabl_f_95_01^2)*(sB.sabl_f_95_01^2))/(B_glm.sabl_f_95_01^4))
deltamethod.sabl_f_95_01

## 95% Confidence Interval equation

con.sabl_f_95_01 <- 1.96*(sqrt(deltamethod.sabl_f_95_01)/sqrt(n.1))
sabl_f_95_01_mat = c(Lmat50.sabl_f_95_01,con.sabl_f_95_01)


### 2007-2018 ###

fit.mat.glm.sabl_f_07_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_07_18$length_cm, maturity <- sabl_f_07_18$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_f_07_18 = c(fit.mat.glm.sabl_f_07_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_f_07_18 <- vector.sabl_f_07_18[1] 
B_glm.sabl_f_07_18 <- vector.sabl_f_07_18[2]
Lmat50.sabl_f_07_18 = -(A_glm.sabl_f_07_18/B_glm.sabl_f_07_18)
Lmat50.sabl_f_07_18

cor(sabl_f_07_18$length_cm, sabl_f_07_18$macro_maturity)

sA.sabl_f_07_18 <- summary (fit.mat.glm.sabl_f_07_18)$coef[1,2] 
sB.sabl_f_07_18 <- summary (fit.mat.glm.sabl_f_07_18)$coef[2,2]    
r.sabl_f_07_18 <-cor(sabl_f_07_18$length_cm, sabl_f_07_18$macro_maturity)
n.1 <- length(sabl_f_07_18$length_cm)

#Variance estimator
deltamethod.sabl_f_07_18 <- ((sA.sabl_f_07_18^2)/(B_glm.sabl_f_07_18^2))- ((2*A_glm.sabl_f_07_18*sA.sabl_f_07_18*sB.sabl_f_07_18*r.sabl_f_07_18)/(B_glm.sabl_f_07_18^3))+ (((A_glm.sabl_f_07_18^2)*(sB.sabl_f_07_18^2))/(B_glm.sabl_f_07_18^4))
deltamethod.sabl_f_07_18

## 95% Confidence Interval equation

con.sabl_f_07_18 <- 1.96*(sqrt(deltamethod.sabl_f_07_18)/sqrt(n.1))
sabl_f_07_18_mat = c(Lmat50.sabl_f_07_18,con.sabl_f_07_18)
```

### All seasons, all codes, no immature fish >= 70cm
```{r fit_glm_sabl_allseasons_allcodes_no70immature}

### 1995-2001 ###

fit.mat.glm.sabl_f_no70immature_95_01 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_no70immature_95_01$length_cm, maturity <- sabl_f_no70immature_95_01$macro_maturity),
                                family = binomial(link ="logit"))
vector.sabl_f_no70immature_95_01 = c(fit.mat.glm.sabl_f_no70immature_95_01$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_f_no70immature_95_01 <- vector.sabl_f_no70immature_95_01[1] 
B_glm.sabl_f_no70immature_95_01 <- vector.sabl_f_no70immature_95_01[2]
Lmat50.sabl_f_no70immature_95_01 = -(A_glm.sabl_f_no70immature_95_01/B_glm.sabl_f_no70immature_95_01)
Lmat50.sabl_f_no70immature_95_01

cor(sabl_f_no70immature_95_01$length_cm, sabl_f_no70immature_95_01$macro_maturity)

sA.sabl_f_no70immature_95_01 <- summary (fit.mat.glm.sabl_f_no70immature_95_01)$coef[1,2] 
sB.sabl_f_no70immature_95_01 <- summary (fit.mat.glm.sabl_f_no70immature_95_01)$coef[2,2]    
r.sabl_f_no70immature_95_01 <-cor(sabl_f_no70immature_95_01$length_cm, sabl_f_no70immature_95_01$macro_maturity)
n.1 <- length(sabl_f_no70immature_95_01$length_cm)

#Variance estimator
deltamethod.sabl_f_no70immature_95_01 <- ((sA.sabl_f_no70immature_95_01^2)/(B_glm.sabl_f_no70immature_95_01^2))- ((2*A_glm.sabl_f_no70immature_95_01*sA.sabl_f_no70immature_95_01*sB.sabl_f_no70immature_95_01*r.sabl_f_no70immature_95_01)/(B_glm.sabl_f_no70immature_95_01^3))+ (((A_glm.sabl_f_no70immature_95_01^2)*(sB.sabl_f_no70immature_95_01^2))/(B_glm.sabl_f_no70immature_95_01^4))
deltamethod.sabl_f_no70immature_95_01

## 95% Confidence Interval equation

con.sabl_f_no70immature_95_01 <- 1.96*(sqrt(deltamethod.sabl_f_no70immature_95_01)/sqrt(n.1))
sabl_f_no70immature_95_01_mat = c(Lmat50.sabl_f_no70immature_95_01,con.sabl_f_no70immature_95_01)


### 2007-2018 ###

fit.mat.glm.sabl_f_no70immature_07_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_no70immature_07_18$length_cm, maturity <- sabl_f_no70immature_07_18$macro_maturity),
                                family = binomial(link ="logit"))
vector.sabl_f_no70immature_07_18 = c(fit.mat.glm.sabl_f_no70immature_07_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_f_no70immature_07_18 <- vector.sabl_f_no70immature_07_18[1] 
B_glm.sabl_f_no70immature_07_18 <- vector.sabl_f_no70immature_07_18[2]
Lmat50.sabl_f_no70immature_07_18 = -(A_glm.sabl_f_no70immature_07_18/B_glm.sabl_f_no70immature_07_18)
Lmat50.sabl_f_no70immature_07_18

cor(sabl_f_no70immature_07_18$length_cm, sabl_f_no70immature_07_18$macro_maturity)

sA.sabl_f_no70immature_07_18 <- summary (fit.mat.glm.sabl_f_no70immature_07_18)$coef[1,2] 
sB.sabl_f_no70immature_07_18 <- summary (fit.mat.glm.sabl_f_no70immature_07_18)$coef[2,2]    
r.sabl_f_no70immature_07_18 <-cor(sabl_f_no70immature_07_18$length_cm, sabl_f_no70immature_07_18$macro_maturity)
n.1 <- length(sabl_f_no70immature_07_18$length_cm)

#Variance estimator
deltamethod.sabl_f_no70immature_07_18 <- ((sA.sabl_f_no70immature_07_18^2)/(B_glm.sabl_f_no70immature_07_18^2))- ((2*A_glm.sabl_f_no70immature_07_18*sA.sabl_f_no70immature_07_18*sB.sabl_f_no70immature_07_18*r.sabl_f_no70immature_07_18)/(B_glm.sabl_f_no70immature_07_18^3))+ (((A_glm.sabl_f_no70immature_07_18^2)*(sB.sabl_f_no70immature_07_18^2))/(B_glm.sabl_f_no70immature_07_18^4))
deltamethod.sabl_f_no70immature_07_18

## 95% Confidence Interval equation

con.sabl_f_no70immature_07_18 <- 1.96*(sqrt(deltamethod.sabl_f_no70immature_07_18)/sqrt(n.1))
sabl_f_no70immature_07_18_mat = c(Lmat50.sabl_f_no70immature_07_18,con.sabl_f_no70immature_07_18)
```



### All seasons, no 7s no 8s and no fish >= 70 cm that are immature
```{r fit_glm_sabl_no7no8_no70immature}

### 1995-2001 ###

fit.mat.glm.sabl_no7no8_no70immature_95_01 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_no7no8_no70immature_95_01$length_cm, maturity <- sabl_f_no7no8_no70immature_95_01$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_no7no8_no70immature_95_01 = c(fit.mat.glm.sabl_no7no8_no70immature_95_01$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_no7no8_no70immature_95_01 <- vector.sabl_no7no8_no70immature_95_01[1] 
B_glm.sabl_no7no8_no70immature_95_01 <- vector.sabl_no7no8_no70immature_95_01[2]
Lmat50.sabl_no7no8_no70immature_95_01 = -(A_glm.sabl_no7no8_no70immature_95_01/B_glm.sabl_no7no8_no70immature_95_01)
Lmat50.sabl_no7no8_no70immature_95_01

cor(sabl_f_no7no8_no70immature_95_01$length_cm, sabl_f_no7no8_no70immature_95_01$macro_maturity)

sA.sabl_no7no8_no70immature_95_01 <- summary (fit.mat.glm.sabl_no7no8_no70immature_95_01)$coef[1,2] 
sB.sabl_no7no8_no70immature_95_01 <- summary (fit.mat.glm.sabl_no7no8_no70immature_95_01)$coef[2,2]    
r.sabl_no7no8_no70immature_95_01 <-cor(sabl_f_no7no8_no70immature_95_01$length_cm, sabl_f_no7no8_no70immature_95_01$macro_maturity)
n.1 <- length(sabl_f_no7no8_no70immature_95_01$length_cm)

#Variance estimator
deltamethod.sabl_no7no8_no70immature_95_01 <- ((sA.sabl_no7no8_no70immature_95_01^2)/(B_glm.sabl_no7no8_no70immature_95_01^2))- ((2*A_glm.sabl_no7no8_no70immature_95_01*sA.sabl_no7no8_no70immature_95_01*sB.sabl_no7no8_no70immature_95_01*r.sabl_no7no8_no70immature_95_01)/(B_glm.sabl_no7no8_no70immature_95_01^3))+ (((A_glm.sabl_no7no8_no70immature_95_01^2)*(sB.sabl_no7no8_no70immature_95_01^2))/(B_glm.sabl_no7no8_no70immature_95_01^4))
deltamethod.sabl_no7no8_no70immature_95_01

## 95% Confidence Interval equation

con.sabl_no7no8_no70immature_95_01 <- 1.96*(sqrt(deltamethod.sabl_no7no8_no70immature_95_01)/sqrt(n.1))
sabl_no7no8_no70immature_95_01_mat = c(Lmat50.sabl_no7no8_no70immature_95_01,con.sabl_no7no8_no70immature_95_01)


### 2007-2018 ###

fit.mat.glm.sabl_no7no8_no70immature_07_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_no7no8_no70immature_07_18$length_cm, maturity <- sabl_f_no7no8_no70immature_07_18$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_no7no8_no70immature_07_18 = c(fit.mat.glm.sabl_no7no8_no70immature_07_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_no7no8_no70immature_07_18 <- vector.sabl_no7no8_no70immature_07_18[1] 
B_glm.sabl_no7no8_no70immature_07_18 <- vector.sabl_no7no8_no70immature_07_18[2]
Lmat50.sabl_no7no8_no70immature_07_18 = -(A_glm.sabl_no7no8_no70immature_07_18/B_glm.sabl_no7no8_no70immature_07_18)
Lmat50.sabl_no7no8_no70immature_07_18

cor(sabl_f_no7no8_no70immature_07_18$length_cm, sabl_f_no7no8_no70immature_07_18$macro_maturity)

sA.sabl_no7no8_no70immature_07_18 <- summary (fit.mat.glm.sabl_no7no8_no70immature_07_18)$coef[1,2] 
sB.sabl_no7no8_no70immature_07_18 <- summary (fit.mat.glm.sabl_no7no8_no70immature_07_18)$coef[2,2]    
r.sabl_no7no8_no70immature_07_18 <-cor(sabl_f_no7no8_no70immature_07_18$length_cm, sabl_f_no7no8_no70immature_07_18$macro_maturity)
n.1 <- length(sabl_f_no7no8_no70immature_07_18$length_cm)

#Variance estimator
deltamethod.sabl_no7no8_no70immature_07_18 <- ((sA.sabl_no7no8_no70immature_07_18^2)/(B_glm.sabl_no7no8_no70immature_07_18^2))- ((2*A_glm.sabl_no7no8_no70immature_07_18*sA.sabl_no7no8_no70immature_07_18*sB.sabl_no7no8_no70immature_07_18*r.sabl_no7no8_no70immature_07_18)/(B_glm.sabl_no7no8_no70immature_07_18^3))+ (((A_glm.sabl_no7no8_no70immature_07_18^2)*(sB.sabl_no7no8_no70immature_07_18^2))/(B_glm.sabl_no7no8_no70immature_07_18^4))
deltamethod.sabl_no7no8_no70immature_07_18

## 95% Confidence Interval equation

con.sabl_no7no8_no70immature_07_18 <- 1.96*(sqrt(deltamethod.sabl_no7no8_no70immature_07_18)/sqrt(n.1))
sabl_no7no8_no70immature_07_18_mat = c(Lmat50.sabl_no7no8_no70immature_07_18,con.sabl_no7no8_no70immature_07_18)
```

### Spawning season, all codes and no fish >= 70 cm that are immature
```{r fit_glm_sabl_allcodes_no70immature}
### 1995-2001 ###
fit.mat.glm.sabl_spwn_no70immature_95_01 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_spwn_no70immature_95_01$length_cm, maturity <- sabl_f_spwn_no70immature_95_01$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_spwn_no70immature_95_01 = c(fit.mat.glm.sabl_spwn_no70immature_95_01$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_spwn_no70immature_95_01 <- vector.sabl_spwn_no70immature_95_01[1] 
B_glm.sabl_spwn_no70immature_95_01 <- vector.sabl_spwn_no70immature_95_01[2]
Lmat50.sabl_spwn_no70immature_95_01 = -(A_glm.sabl_spwn_no70immature_95_01/B_glm.sabl_spwn_no70immature_95_01)
Lmat50.sabl_spwn_no70immature_95_01

cor(sabl_f_spwn_no70immature_95_01$length_cm, sabl_f_spwn_no70immature_95_01$macro_maturity)

sA.sabl_spwn_no70immature_95_01 <- summary (fit.mat.glm.sabl_spwn_no70immature_95_01)$coef[1,2] 
sB.sabl_spwn_no70immature_95_01 <- summary (fit.mat.glm.sabl_spwn_no70immature_95_01)$coef[2,2]    
r.sabl_spwn_no70immature_95_01 <-cor(sabl_f_spwn_no70immature_95_01$length_cm, sabl_f_spwn_no70immature_95_01$macro_maturity)
n.1 <- length(sabl_f_spwn_no70immature_95_01$length_cm)

#Variance estimator
deltamethod.sabl_spwn_no70immature_95_01 <- ((sA.sabl_spwn_no70immature_95_01^2)/(B_glm.sabl_spwn_no70immature_95_01^2))- ((2*A_glm.sabl_spwn_no70immature_95_01*sA.sabl_spwn_no70immature_95_01*sB.sabl_spwn_no70immature_95_01*r.sabl_spwn_no70immature_95_01)/(B_glm.sabl_spwn_no70immature_95_01^3))+ (((A_glm.sabl_spwn_no70immature_95_01^2)*(sB.sabl_spwn_no70immature_95_01^2))/(B_glm.sabl_spwn_no70immature_95_01^4))
deltamethod.sabl_spwn_no70immature_95_01

## 95% Confidence Interval equation

con.sabl_spwn_no70immature_95_01 <- 1.96*(sqrt(deltamethod.sabl_spwn_no70immature_95_01)/sqrt(n.1))
sabl_spwn_no70immature_95_01_mat = c(Lmat50.sabl_spwn_no70immature_95_01,con.sabl_spwn_no70immature_95_01)


### 2007-2018 ###

fit.mat.glm.sabl_spwn_no70immature_07_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_spwn_no70immature_07_18$length_cm, maturity <- sabl_f_spwn_no70immature_07_18$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_spwn_no70immature_07_18 = c(fit.mat.glm.sabl_spwn_no70immature_07_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_spwn_no70immature_07_18 <- vector.sabl_spwn_no70immature_07_18[1] 
B_glm.sabl_spwn_no70immature_07_18 <- vector.sabl_spwn_no70immature_07_18[2]
Lmat50.sabl_spwn_no70immature_07_18 = -(A_glm.sabl_spwn_no70immature_07_18/B_glm.sabl_spwn_no70immature_07_18)
Lmat50.sabl_spwn_no70immature_07_18

cor(sabl_f_spwn_no70immature_07_18$length_cm, sabl_f_spwn_no70immature_07_18$macro_maturity)

sA.sabl_spwn_no70immature_07_18 <- summary (fit.mat.glm.sabl_spwn_no70immature_07_18)$coef[1,2] 
sB.sabl_spwn_no70immature_07_18 <- summary (fit.mat.glm.sabl_spwn_no70immature_07_18)$coef[2,2]    
r.sabl_spwn_no70immature_07_18 <-cor(sabl_f_spwn_no70immature_07_18$length_cm, sabl_f_spwn_no70immature_07_18$macro_maturity)
n.1 <- length(sabl_f_spwn_no70immature_07_18$length_cm)

#Variance estimator
deltamethod.sabl_spwn_no70immature_07_18 <- ((sA.sabl_spwn_no70immature_07_18^2)/(B_glm.sabl_spwn_no70immature_07_18^2))- ((2*A_glm.sabl_spwn_no70immature_07_18*sA.sabl_spwn_no70immature_07_18*sB.sabl_spwn_no70immature_07_18*r.sabl_spwn_no70immature_07_18)/(B_glm.sabl_spwn_no70immature_07_18^3))+ (((A_glm.sabl_spwn_no70immature_07_18^2)*(sB.sabl_spwn_no70immature_07_18^2))/(B_glm.sabl_spwn_no70immature_07_18^4))
deltamethod.sabl_spwn_no70immature_07_18

## 95% Confidence Interval equation

con.sabl_spwn_no70immature_07_18 <- 1.96*(sqrt(deltamethod.sabl_spwn_no70immature_07_18)/sqrt(n.1))
sabl_spwn_no70immature_07_18_mat = c(Lmat50.sabl_spwn_no70immature_07_18,con.sabl_spwn_no70immature_07_18)
```
### Spawning season, no 7s no 8s and no fish >= 70 cm that are immature
```{r fit_glm_sabl_no7no8_no70immature}
### 1995-2001 ###
fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_spwn_no70immature_no7no8_95_01$length_cm, maturity <- sabl_f_spwn_no70immature_no7no8_95_01$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_spwn_no70immature_no7no8_95_01 = c(fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_spwn_no70immature_no7no8_95_01 <- vector.sabl_spwn_no70immature_no7no8_95_01[1] 
B_glm.sabl_spwn_no70immature_no7no8_95_01 <- vector.sabl_spwn_no70immature_no7no8_95_01[2]
Lmat50.sabl_spwn_no70immature_no7no8_95_01 = -(A_glm.sabl_spwn_no70immature_no7no8_95_01/B_glm.sabl_spwn_no70immature_no7no8_95_01)
Lmat50.sabl_spwn_no70immature_no7no8_95_01

cor(sabl_f_spwn_no70immature_no7no8_95_01$length_cm, sabl_f_spwn_no70immature_no7no8_95_01$macro_maturity)

sA.sabl_spwn_no70immature_no7no8_95_01 <- summary (fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01)$coef[1,2] 
sB.sabl_spwn_no70immature_no7no8_95_01 <- summary (fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01)$coef[2,2]    
r.sabl_spwn_no70immature_no7no8_95_01 <-cor(sabl_f_spwn_no70immature_no7no8_95_01$length_cm, sabl_f_spwn_no70immature_no7no8_95_01$macro_maturity)
n.1 <- length(sabl_f_spwn_no70immature_no7no8_95_01$length_cm)

#Variance estimator
deltamethod.sabl_spwn_no70immature_no7no8_95_01 <- ((sA.sabl_spwn_no70immature_no7no8_95_01^2)/(B_glm.sabl_spwn_no70immature_no7no8_95_01^2))- ((2*A_glm.sabl_spwn_no70immature_no7no8_95_01*sA.sabl_spwn_no70immature_no7no8_95_01*sB.sabl_spwn_no70immature_no7no8_95_01*r.sabl_spwn_no70immature_no7no8_95_01)/(B_glm.sabl_spwn_no70immature_no7no8_95_01^3))+ (((A_glm.sabl_spwn_no70immature_no7no8_95_01^2)*(sB.sabl_spwn_no70immature_no7no8_95_01^2))/(B_glm.sabl_spwn_no70immature_no7no8_95_01^4))
deltamethod.sabl_spwn_no70immature_no7no8_95_01

## 95% Confidence Interval equation

con.sabl_spwn_no70immature_no7no8_95_01 <- 1.96*(sqrt(deltamethod.sabl_spwn_no70immature_no7no8_95_01)/sqrt(n.1))
sabl_spwn_no70immature_no7no8_95_01_mat <- c(Lmat50.sabl_spwn_no70immature_no7no8_95_01,con.sabl_spwn_no70immature_no7no8_95_01)


### 2007-2018 ###

fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18 <- glm(maturity ~ 1 + length, data <-data.frame(length = sabl_f_spwn_no70immature_no7no8_07_18$length_cm, maturity <- sabl_f_spwn_no70immature_no7no8_07_18$macro_maturity),
                                                       family = binomial(link ="logit"))
vector.sabl_spwn_no70immature_no7no8_07_18 = c(fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18$coefficients)

# A_glm = intercept
# B_glm = slope

A_glm.sabl_spwn_no70immature_no7no8_07_18 <- vector.sabl_spwn_no70immature_no7no8_07_18[1] 
B_glm.sabl_spwn_no70immature_no7no8_07_18 <- vector.sabl_spwn_no70immature_no7no8_07_18[2]
Lmat50.sabl_spwn_no70immature_no7no8_07_18 = -(A_glm.sabl_spwn_no70immature_no7no8_07_18/B_glm.sabl_spwn_no70immature_no7no8_07_18)
Lmat50.sabl_spwn_no70immature_no7no8_07_18

cor(sabl_f_spwn_no70immature_no7no8_07_18$length_cm, sabl_f_spwn_no70immature_no7no8_07_18$macro_maturity)

sA.sabl_spwn_no70immature_no7no8_07_18 <- summary (fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18)$coef[1,2] 
sB.sabl_spwn_no70immature_no7no8_07_18 <- summary (fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18)$coef[2,2]    
r.sabl_spwn_no70immature_no7no8_07_18 <-cor(sabl_f_spwn_no70immature_no7no8_07_18$length_cm, sabl_f_spwn_no70immature_no7no8_07_18$macro_maturity)
n.1 <- length(sabl_f_spwn_no70immature_no7no8_07_18$length_cm)

#Variance estimator
deltamethod.sabl_spwn_no70immature_no7no8_07_18 <- ((sA.sabl_spwn_no70immature_no7no8_07_18^2)/(B_glm.sabl_spwn_no70immature_no7no8_07_18^2))- ((2*A_glm.sabl_spwn_no70immature_no7no8_07_18*sA.sabl_spwn_no70immature_no7no8_07_18*sB.sabl_spwn_no70immature_no7no8_07_18*r.sabl_spwn_no70immature_no7no8_07_18)/(B_glm.sabl_spwn_no70immature_no7no8_07_18^3))+ (((A_glm.sabl_spwn_no70immature_no7no8_07_18^2)*(sB.sabl_spwn_no70immature_no7no8_07_18^2))/(B_glm.sabl_spwn_no70immature_no7no8_07_18^4))
deltamethod.sabl_spwn_no70immature_no7no8_07_18

## 95% Confidence Interval equation

con.sabl_spwn_no70immature_no7no8_07_18 <- 1.96*(sqrt(deltamethod.sabl_spwn_no70immature_no7no8_07_18)/sqrt(n.1))
sabl_spwn_no70immature_no7no8_07_18_mat = c(Lmat50.sabl_spwn_no70immature_no7no8_07_18,con.sabl_spwn_no70immature_no7no8_07_18)
```



# Store sensitivity analyes in a table (supplemental table)

### Canary rockfish, 1980-1984
```{r store_canary_1980_1984_sensitivity_results_table}
### RESULTS ###

cnry_80_84_glm_results <- rbind(cnry_80_84_mat, cnry_no7no8_80_84_mat, cnry_spwn_80_84_mat, cnry_spwn_no7no8_80_84_mat)
colnames(cnry_80_84_glm_results) = c("Lmat50", "plusminusCI95")
cnry_80_84_glm_results = as.data.frame(cnry_80_84_glm_results)
cnry_80_84_glm_results$time_period <- "1980-1984"
cnry_80_84_glm_results <- rownames_to_column(cnry_80_84_glm_results, "data_processing")
cnry_80_84_glm_results %>% 
  mutate(., CI_95 = paste0(round(Lmat50-plusminusCI95,2), "-", round(Lmat50+plusminusCI95,2))) -> cnry_80_84_glm_results

# Here we're adding a column which is the result of pasting the value and then the standard error for each value

# alpha parameter
cnry_80_84_glm_results$alpha <- c(paste0(round(A_glm.cnry_80_84,2), " (", round(sA.cnry_80_84,2), ")"),
                                  paste0(round(A_glm.cnry_no7no8_80_84,2), " (", round(sA.cnry_no7no8_80_84,2), ")"),
                                  paste0(round(A_glm.cnry_spwn_80_84,2), " (", round(sA.cnry_spwn_80_84,2), ")"),
                                  paste0(round(A_glm.cnry_spwn_no7no8_80_84,2), " (", round(sA.cnry_spwn_no7no8_80_84,2), ")"))

# beta parameter
cnry_80_84_glm_results$beta <- c(paste0(round(B_glm.cnry_80_84,2), " (", round(sB.cnry_80_84,2), ")"),
                                  paste0(round(B_glm.cnry_no7no8_80_84,2), " (", round(sB.cnry_no7no8_80_84,2), ")"),
                                  paste0(round(B_glm.cnry_spwn_80_84,2), " (", round(sB.cnry_spwn_80_84,2), ")"),
                                  paste0(round(B_glm.cnry_spwn_no7no8_80_84,2), " (", round(sB.cnry_spwn_no7no8_80_84,2), ")"))

# sample size
cnry_80_84_glm_results$n <- c(nrow(cnry_f_80_84), nrow(cnry_f_no7no8_80_84), nrow(cnry_f_spwn_80_84), nrow(cnry_f_spwn_no7no8_80_84))


# round values
cnry_80_84_glm_results$Lmat50 <- round(cnry_80_84_glm_results$Lmat50, 2)
cnry_80_84_glm_results$plusminusCI95 <- round(cnry_80_84_glm_results$plusminusCI95, 2)

# add columns for data pre-processing steps
cnry_80_84_glm_results$resting_stage_removed <- c("No", "Yes", "No", "Yes")
cnry_80_84_glm_results$spwn_season_iso <- c("No", "No", "Yes", "Yes")
```

### Canary rockfish, 2010-2018

```{r store_canary_2010_2018_sensitivity_results_table}
### RESULTS ###

cnry_10_18_glm_results <- rbind(cnry_10_18_mat, cnry_no7no8_10_18_mat, cnry_spwn_10_18_mat, cnry_spwn_no7no8_10_18_mat)
colnames(cnry_10_18_glm_results) = c("Lmat50", "plusminusCI95")
cnry_10_18_glm_results = as.data.frame(cnry_10_18_glm_results)
cnry_10_18_glm_results$time_period <- "2010-2018"
cnry_10_18_glm_results <- rownames_to_column(cnry_10_18_glm_results, "data_processing")
cnry_10_18_glm_results %>% 
  mutate(., CI_95 = paste0(round(Lmat50-plusminusCI95,2), "-", round(Lmat50+plusminusCI95,2))) -> cnry_10_18_glm_results

# Here we're adding a column which is the result of pasting the value and then the standard error for each value

# alpha parameter
cnry_10_18_glm_results$alpha <- c(paste0(round(A_glm.cnry_10_18,2), " (", round(sA.cnry_10_18,2), ")"),
                                  paste0(round(A_glm.cnry_no7no8_10_18,2), " (", round(sA.cnry_no7no8_10_18,2), ")"),
                                  paste0(round(A_glm.cnry_spwn_10_18,2), " (", round(sA.cnry_spwn_10_18,2), ")"),
                                  paste0(round(A_glm.cnry_spwn_no7no8_10_18,2), " (", round(sA.cnry_spwn_no7no8_10_18,2), ")"))

# beta parameter
cnry_10_18_glm_results$beta <- c(paste0(round(B_glm.cnry_10_18,2), " (", round(sB.cnry_10_18,2), ")"),
                                 paste0(round(B_glm.cnry_no7no8_10_18,2), " (", round(sB.cnry_no7no8_10_18,2), ")"),
                                 paste0(round(B_glm.cnry_spwn_10_18,2), " (", round(sB.cnry_spwn_10_18,2), ")"),
                                 paste0(round(B_glm.cnry_spwn_no7no8_10_18,2), " (", round(sB.cnry_spwn_no7no8_10_18,2), ")"))

# sample size
cnry_10_18_glm_results$n <- c(nrow(cnry_f_10_18), nrow(cnry_f_no7no8_10_18), nrow(cnry_f_spwn_10_18), nrow(cnry_f_spwn_no7no8_10_18))


# round values
cnry_10_18_glm_results$Lmat50 <- round(cnry_10_18_glm_results$Lmat50, 2)
cnry_10_18_glm_results$plusminusCI95 <- round(cnry_10_18_glm_results$plusminusCI95, 2)

# add columns for data pre-processing steps
cnry_10_18_glm_results$resting_stage_removed <- c("No", "Yes", "No", "Yes")
cnry_10_18_glm_results$spwn_season_iso <- c("No", "No", "Yes", "Yes")
```

### Merge canary results and export
```{r export_cnry_sensitivity_analysis_table}
cnry_80_84_glm_results %>% 
  bind_rows(., cnry_10_18_glm_results) -> cnry_hist_sensitivity_table

write.csv(cnry_hist_sensitivity_table, here("tables", "canary_historical_sensitivity_table.csv"), row.names = FALSE)
```

### Sablefish, 1995-2001
```{r store_sablefish_1995_2001_sensitivity_results_table}
### RESULTS ###

sabl_f_95_01_glm_results <- rbind(sabl_f_95_01_mat, sabl_f_no70immature_95_01_mat, sabl_no7no8_no70immature_95_01_mat, sabl_spwn_no70immature_95_01_mat, sabl_spwn_no70immature_no7no8_95_01_mat)
colnames(sabl_f_95_01_glm_results) = c("Lmat50", "plusminusCI95")
sabl_f_95_01_glm_results = as.data.frame(sabl_f_95_01_glm_results)
sabl_f_95_01_glm_results$time_period <- "1995-2001"
sabl_f_95_01_glm_results <- rownames_to_column(sabl_f_95_01_glm_results, "data_processing")
sabl_f_95_01_glm_results %>% 
  mutate(., CI_95 = paste0(round(Lmat50-plusminusCI95,2), "-", round(Lmat50+plusminusCI95,2))) -> sabl_f_95_01_glm_results

# Here we're adding a column which is the result of pasting the value and then the standard error for each value

# alpha parameter
sabl_f_95_01_glm_results$alpha <- c(paste0(round(A_glm.sabl_f_95_01,2), " (", round(sA.sabl_f_95_01,2), ")"),
                                  paste0(round(A_glm.sabl_f_no70immature_95_01,2), " (", round(sA.sabl_f_no70immature_95_01,2), ")"),
                                  paste0(round(A_glm.sabl_no7no8_no70immature_95_01,2), " (", round(sA.sabl_no7no8_no70immature_95_01,2), ")"),
                                  paste0(round(A_glm.sabl_spwn_no70immature_95_01,2), " (", round(sA.sabl_spwn_no70immature_95_01,2), ")"),
                                  paste0(round(A_glm.sabl_spwn_no70immature_no7no8_95_01,2), " (", round(sA.sabl_spwn_no70immature_no7no8_95_01,2), ")"))

# beta parameter
sabl_f_95_01_glm_results$beta <- c(paste0(round(B_glm.sabl_f_95_01,2), " (", round(sB.sabl_f_95_01,2), ")"),
                                   paste0(round(B_glm.sabl_f_no70immature_95_01,2), " (", round(sB.sabl_f_no70immature_95_01,2), ")"),
                                 paste0(round(B_glm.sabl_no7no8_no70immature_95_01,2), " (", round(sB.sabl_no7no8_no70immature_95_01,2), ")"),
                                 paste0(round(B_glm.sabl_spwn_no70immature_95_01,2), " (", round(sB.sabl_spwn_no70immature_95_01,2), ")"),
                                 paste0(round(B_glm.sabl_spwn_no70immature_no7no8_95_01,2), " (", round(sB.sabl_spwn_no70immature_no7no8_95_01,2), ")"))
sabl_f_no7no8_no70immature_95_01
# sample size
sabl_f_95_01_glm_results$n <- c(nrow(sabl_f_95_01), nrow(sabl_f_no70immature_95_01), nrow(sabl_f_no7no8_no70immature_95_01), nrow(sabl_f_spwn_no70immature_95_01), nrow(sabl_f_spwn_no70immature_no7no8_95_01))

# round values
sabl_f_95_01_glm_results$Lmat50 <- round(sabl_f_95_01_glm_results$Lmat50, 2)
sabl_f_95_01_glm_results$plusminusCI95 <- round(sabl_f_95_01_glm_results$plusminusCI95, 2)

# add columns for data pre-processing steps
sabl_f_95_01_glm_results$resting_stage_removed <- c("No", "No", "Yes", "No", "Yes")
sabl_f_95_01_glm_results$spwn_season_iso <- c("No", "No", "No", "Yes", "Yes")
sabl_f_95_01_glm_results$immature_70cm_plus_removed <- c("No", "Yes", "Yes", "Yes", "Yes")
```


### Sablefish, 2007-2018
```{r store_sablefish_2007_2018_sensitivity_results_table}
### RESULTS ###

sabl_f_07_18_glm_results <- rbind(sabl_f_07_18_mat, sabl_f_no70immature_07_18_mat, sabl_no7no8_no70immature_07_18_mat, sabl_spwn_no70immature_07_18_mat, sabl_spwn_no70immature_no7no8_07_18_mat)
colnames(sabl_f_07_18_glm_results) = c("Lmat50", "plusminusCI95")
sabl_f_07_18_glm_results = as.data.frame(sabl_f_07_18_glm_results)
sabl_f_07_18_glm_results$time_period <- "1995-2001"
sabl_f_07_18_glm_results <- rownames_to_column(sabl_f_07_18_glm_results, "data_processing")
sabl_f_07_18_glm_results %>% 
  mutate(., CI_95 = paste0(round(Lmat50-plusminusCI95,2), "-", round(Lmat50+plusminusCI95,2))) -> sabl_f_07_18_glm_results

# Here we're adding a column which is the result of pasting the value and then the standard error for each value

# alpha parameter
sabl_f_07_18_glm_results$alpha <- c(paste0(round(A_glm.sabl_f_07_18,2), " (", round(sA.sabl_f_07_18,2), ")"),
                                    paste0(round(A_glm.sabl_f_no70immature_07_18,2), " (", round(sA.sabl_f_no70immature_07_18,2), ")"),
                                    paste0(round(A_glm.sabl_no7no8_no70immature_07_18,2), " (", round(sA.sabl_no7no8_no70immature_07_18,2), ")"),
                                    paste0(round(A_glm.sabl_spwn_no70immature_07_18,2), " (", round(sA.sabl_spwn_no70immature_07_18,2), ")"),
                                    paste0(round(A_glm.sabl_spwn_no70immature_no7no8_07_18,2), " (", round(sA.sabl_spwn_no70immature_no7no8_07_18,2), ")"))

# beta parameter
sabl_f_07_18_glm_results$beta <- c(paste0(round(B_glm.sabl_f_07_18,2), " (", round(sB.sabl_f_07_18,2), ")"),
                                   paste0(round(B_glm.sabl_f_no70immature_07_18,2), " (", round(sB.sabl_f_no70immature_07_18,2), ")"),
                                   paste0(round(B_glm.sabl_no7no8_no70immature_07_18,2), " (", round(sB.sabl_no7no8_no70immature_07_18,2), ")"),
                                   paste0(round(B_glm.sabl_spwn_no70immature_07_18,2), " (", round(sB.sabl_spwn_no70immature_07_18,2), ")"),
                                   paste0(round(B_glm.sabl_spwn_no70immature_no7no8_07_18,2), " (", round(sB.sabl_spwn_no70immature_no7no8_07_18,2), ")"))

sabl_f_07_18_glm_results$n <- c(nrow(sabl_f_07_18), nrow(sabl_f_no70immature_07_18), nrow(sabl_f_no7no8_no70immature_07_18), nrow(sabl_f_spwn_no70immature_07_18), nrow(sabl_f_spwn_no70immature_no7no8_07_18))


# round values
sabl_f_07_18_glm_results$Lmat50 <- round(sabl_f_07_18_glm_results$Lmat50, 2)
sabl_f_07_18_glm_results$plusminusCI95 <- round(sabl_f_07_18_glm_results$plusminusCI95, 2)

# add columns for data pre-processing steps
sabl_f_07_18_glm_results$resting_stage_removed <- c("No", "No", "Yes", "No", "Yes")
sabl_f_07_18_glm_results$spwn_season_iso <- c("No", "No", "No", "Yes", "Yes")
sabl_f_07_18_glm_results$immature_70cm_plus_removed <- c("No", "Yes", "Yes", "Yes", "Yes")
```


### Merge sablefish results and export
```{r export_sabl_sensitivity_analysis_table}
sabl_f_95_01_glm_results %>% 
  bind_rows(., sabl_f_07_18_glm_results) -> sabl_hist_sensitivity_table

write.csv(sabl_hist_sensitivity_table, here("tables", "sablefish_historical_sensitivity_table.csv"), row.names = FALSE)
```

# Plot - each individually

## Canary rockfish

### All seasons, all maturity codes
```{r get_parameters_for_plot_cnry_allseasons_allcodes}
# 1980-1984
bin_cnry_80_84 <- cnry_prop_mature_f_80_84$length_cm
prop_cnry_80_84 <- cnry_prop_mature_f_80_84$prop_mature
n_cnry_80_84 <- cnry_prop_mature_f_80_84$n
fit.mat.glm.cnry_80_84[1]
df.fit.mat.glm.cnry_80_84 = as.data.frame(fit.mat.glm.cnry_80_84[1])
A_glm.cnry_80_84 = df.fit.mat.glm.cnry_80_84$coefficients[1]
B_glm.cnry_80_84 = df.fit.mat.glm.cnry_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_10_18 <- cnry_prop_mature_f_10_18$length_cm
prop_cnry_10_18 <- cnry_prop_mature_f_10_18$prop_mature
n_cnry_10_18 <- cnry_prop_mature_f_10_18$n
fit.mat.glm.cnry_10_18[1]
df.fit.mat.glm.cnry_10_18 = as.data.frame(fit.mat.glm.cnry_10_18[1])
A_glm.cnry_10_18 = df.fit.mat.glm.cnry_10_18$coefficients[1]
B_glm.cnry_10_18 = df.fit.mat.glm.cnry_10_18$coefficients[2]
```

```{r plot_cnry_allseasons_allcodes_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "cnry_allseasons_allcodes_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_80_84, y = prop_cnry_80_84,cex=0.7*sqrt(n_cnry_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_10_18, y = prop_cnry_10_18,cex=0.7*sqrt(n_cnry_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_80_84+(B_glm.cnry_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_10_18+(B_glm.cnry_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_80_84 <- predict(fit.mat.glm.cnry_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_10_18 <- predict(fit.mat.glm.cnry_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

dev.off()

```



### All seasons, no 7s and no 8s
```{r get_parameters_for_plot_cnry_allseasons_no7no8}
# 1980-1984
bin_cnry_no7no8_80_84 <- cnry_prop_mature_f_no7no8_80_84$length_cm
prop_cnry_no7no8_80_84 <- cnry_prop_mature_f_no7no8_80_84$prop_mature
n_cnry_no7no8_80_84 <- cnry_prop_mature_f_no7no8_80_84$n
fit.mat.glm.cnry_no7no8_80_84[1]
df.fit.mat.glm.cnry_no7no8_80_84 = as.data.frame(fit.mat.glm.cnry_no7no8_80_84[1])
A_glm.cnry_no7no8_80_84 = df.fit.mat.glm.cnry_no7no8_80_84$coefficients[1]
B_glm.cnry_no7no8_80_84 = df.fit.mat.glm.cnry_no7no8_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_no7no8_10_18 <- cnry_prop_mature_f_no7no8_10_18$length_cm
prop_cnry_no7no8_10_18 <- cnry_prop_mature_f_no7no8_10_18$prop_mature
n_cnry_no7no8_10_18 <- cnry_prop_mature_f_no7no8_10_18$n
fit.mat.glm.cnry_no7no8_10_18[1]
df.fit.mat.glm.cnry_no7no8_10_18 = as.data.frame(fit.mat.glm.cnry_no7no8_10_18[1])
A_glm.cnry_no7no8_10_18 = df.fit.mat.glm.cnry_no7no8_10_18$coefficients[1]
B_glm.cnry_no7no8_10_18 = df.fit.mat.glm.cnry_no7no8_10_18$coefficients[2]
```

```{r plot_cnry_allseasons_no7no8_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "cnry_allseasons_no7no8_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_no7no8_80_84, y = prop_cnry_no7no8_80_84,cex=0.7*sqrt(n_cnry_no7no8_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_no7no8_10_18, y = prop_cnry_no7no8_10_18,cex=0.7*sqrt(n_cnry_no7no8_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_no7no8_80_84+(B_glm.cnry_no7no8_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_no7no8_10_18+(B_glm.cnry_no7no8_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_no7no8_80_84 <- predict(fit.mat.glm.cnry_no7no8_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_no7no8_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_no7no8_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_no7no8_10_18 <- predict(fit.mat.glm.cnry_no7no8_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_no7no8_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_no7no8_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

dev.off()

```







### Spawning season, all maturity codes
```{r get_parameters_for_plot_cnry_allcodes}
# 1980-1984
bin_cnry_spwn_80_84 <- cnry_prop_mature_f_spwn_80_84$length_cm
prop_cnry_spwn_80_84 <- cnry_prop_mature_f_spwn_80_84$prop_mature
n_cnry_spwn_80_84 <- cnry_prop_mature_f_spwn_80_84$n
fit.mat.glm.cnry_spwn_80_84[1]
df.fit.mat.glm.cnry_spwn_80_84 = as.data.frame(fit.mat.glm.cnry_spwn_80_84[1])
A_glm.cnry_spwn_80_84 = df.fit.mat.glm.cnry_spwn_80_84$coefficients[1]
B_glm.cnry_spwn_80_84 = df.fit.mat.glm.cnry_spwn_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_spwn_10_18 <- cnry_prop_mature_f_spwn_10_18$length_cm
prop_cnry_spwn_10_18 <- cnry_prop_mature_f_spwn_10_18$prop_mature
n_cnry_spwn_10_18 <- cnry_prop_mature_f_spwn_10_18$n
fit.mat.glm.cnry_spwn_10_18[1]
df.fit.mat.glm.cnry_spwn_10_18 = as.data.frame(fit.mat.glm.cnry_spwn_10_18[1])
A_glm.cnry_spwn_10_18 = df.fit.mat.glm.cnry_spwn_10_18$coefficients[1]
B_glm.cnry_spwn_10_18 = df.fit.mat.glm.cnry_spwn_10_18$coefficients[2]
```

```{r plot_cnry_spwn_allcodes_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "cnry_spwn_allcodes_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_spwn_80_84, y = prop_cnry_spwn_80_84,cex=0.7*sqrt(n_cnry_spwn_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_spwn_10_18, y = prop_cnry_spwn_10_18,cex=0.7*sqrt(n_cnry_spwn_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_80_84+(B_glm.cnry_spwn_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_10_18+(B_glm.cnry_spwn_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_spwn_80_84 <- predict(fit.mat.glm.cnry_spwn_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_spwn_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_spwn_10_18 <- predict(fit.mat.glm.cnry_spwn_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_spwn_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              15, 20)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

dev.off()

```



### FIG 2: Spawning season, no 7s and no 8s
```{r get_parameters_for_plot_cnry_spwn_no7no8}
# 1980-1984
bin_cnry_spwn_no7no8_80_84 <- cnry_prop_mature_f_spwn_no7no8_80_84$length_cm
prop_cnry_spwn_no7no8_80_84 <- cnry_prop_mature_f_spwn_no7no8_80_84$prop_mature
n_cnry_spwn_no7no8_80_84 <- cnry_prop_mature_f_spwn_no7no8_80_84$n
fit.mat.glm.cnry_spwn_no7no8_80_84[1]
df.fit.mat.glm.cnry_spwn_no7no8_80_84 = as.data.frame(fit.mat.glm.cnry_spwn_no7no8_80_84[1])
A_glm.cnry_spwn_no7no8_80_84 = df.fit.mat.glm.cnry_spwn_no7no8_80_84$coefficients[1]
B_glm.cnry_spwn_no7no8_80_84 = df.fit.mat.glm.cnry_spwn_no7no8_80_84$coefficients[2]

# 1998-2003
bin_cnry_spwn_no7no8_98_03 <- cnry_prop_mature_f_spwn_no7no8_98_03$length_cm
prop_cnry_spwn_no7no8_98_03 <- cnry_prop_mature_f_spwn_no7no8_98_03$prop_mature
n_cnry_spwn_no7no8_98_03 <- cnry_prop_mature_f_spwn_no7no8_98_03$n
fit.mat.glm.cnry_spwn_no7no8_98_03[1]
df.fit.mat.glm.cnry_spwn_no7no8_98_03 = as.data.frame(fit.mat.glm.cnry_spwn_no7no8_98_03[1])
A_glm.cnry_spwn_no7no8_98_03 = df.fit.mat.glm.cnry_spwn_no7no8_98_03$coefficients[1]
B_glm.cnry_spwn_no7no8_98_03 = df.fit.mat.glm.cnry_spwn_no7no8_98_03$coefficients[2]

# 2010-2018 # 
bin_cnry_spwn_no7no8_10_18 <- cnry_prop_mature_f_spwn_no7no8_10_18$length_cm
prop_cnry_spwn_no7no8_10_18 <- cnry_prop_mature_f_spwn_no7no8_10_18$prop_mature
n_cnry_spwn_no7no8_10_18 <- cnry_prop_mature_f_spwn_no7no8_10_18$n
fit.mat.glm.cnry_spwn_no7no8_10_18[1]
df.fit.mat.glm.cnry_spwn_no7no8_10_18 = as.data.frame(fit.mat.glm.cnry_spwn_no7no8_10_18[1])
A_glm.cnry_spwn_no7no8_10_18 = df.fit.mat.glm.cnry_spwn_no7no8_10_18$coefficients[1]
B_glm.cnry_spwn_no7no8_10_18 = df.fit.mat.glm.cnry_spwn_no7no8_10_18$coefficients[2]
```

```{r plot_cnry_no7no8_comparisons}
# third color - orange
# dark: #ff7f00
# light: #fdbf6f

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "cnry_spwn_no7no8_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_spwn_no7no8_80_84, y = prop_cnry_spwn_no7no8_80_84,cex=0.7*sqrt(n_cnry_spwn_no7no8_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_spwn_no7no8_10_18, y = prop_cnry_spwn_no7no8_10_18,cex=0.7*sqrt(n_cnry_spwn_no7no8_10_18), pch=16, col = "#92c5de")
# points(x = bin_cnry_spwn_no7no8_98_03, y = prop_cnry_spwn_no7no8_98_03,cex=0.7*sqrt(n_cnry_spwn_no7no8_98_03), pch=16, col = "#fdbf6f")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_no7no8_80_84+(B_glm.cnry_spwn_no7no8_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_no7no8_10_18+(B_glm.cnry_spwn_no7no8_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####
# lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_no7no8_98_03+(B_glm.cnry_spwn_no7no8_98_03*(20:70)))))), type = "l", col='#ff7f00', pch = 19, lty =1,lwd = 3)####Time Period 3#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_spwn_no7no8_80_84 <- predict(fit.mat.glm.cnry_spwn_no7no8_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_no7no8_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_spwn_no7no8_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_spwn_no7no8_10_18 <- predict(fit.mat.glm.cnry_spwn_no7no8_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_no7no8_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_spwn_no7no8_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))

# predat_cnry_spwn_no7no8_98_03 <- predict(fit.mat.glm.cnry_spwn_no7no8_98_03,newdata=plotdat, se.fit=TRUE)
# with(predat_cnry_spwn_no7no8_98_03, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#ff7f00"))
# with(predat_cnry_spwn_no7no8_98_03, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#ff7f00"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              15, 20)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.15, legend=c("1980-1984", "2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

# legend(54,0.15, legend=c("1980-1984", "1998-2003", "2010-2018"), col=c("#b2182b", "#ff7f00", "#2166ac"), lwd=c(3,3),
#        lty= c(1,1,1), cex=1.5, bty="n")

dev.off()

```





## Sablefish

### All seasons, all codes, all fish
```{r get_parameters_for_plot_sabl_allcodes_allseasons_allfish}
# 1995-2001 # 
bin_sabl_f_95_01 <- sabl_prop_mature_f_95_01$length_cm
prop_sabl_f_95_01 <- sabl_prop_mature_f_95_01$prop_mature
n_sabl_f_95_01 <- sabl_prop_mature_f_95_01$n
fit.mat.glm.sabl_f_95_01[1]
df.fit.mat.glm.sabl_f_95_01 = as.data.frame(fit.mat.glm.sabl_f_95_01[1])
A_glm.sabl_f_95_01 = df.fit.mat.glm.sabl_f_95_01$coefficients[1]
B_glm.sabl_f_95_01 = df.fit.mat.glm.sabl_f_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_07_18 <- sabl_prop_mature_f_07_18$length_cm
prop_sabl_f_07_18 <- sabl_prop_mature_f_07_18$prop_mature
n_sabl_f_07_18 <- sabl_prop_mature_f_07_18$n
fit.mat.glm.sabl_f_07_18[1]
df.fit.mat.glm.sabl_f_07_18 = as.data.frame(fit.mat.glm.sabl_f_07_18[1])
A_glm.sabl_f_07_18 = df.fit.mat.glm.sabl_f_07_18$coefficients[1]
B_glm.sabl_f_07_18 = df.fit.mat.glm.sabl_f_07_18$coefficients[2]
```

```{r plot_sabl_allcodes_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_allcodes_allfish_histcomp.eps"), height = 8, width = 8)

par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_95_01, y = prop_sabl_f_95_01,cex=0.7*sqrt(n_sabl_f_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_07_18, y = prop_sabl_f_07_18,cex=0.7*sqrt(n_sabl_f_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_95_01+(B_glm.sabl_f_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_07_18+(B_glm.sabl_f_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_95_01 <- predict(fit.mat.glm.sabl_f_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_07_18 <- predict(fit.mat.glm.sabl_f_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)


dev.off()

```


### All seasons, all codes, no immature fish >= 70 cm
```{r get_parameters_sabl_allcodes_allseasons_no70immature}
# 1995-2001 # 
bin_sabl_f_no70immature_95_01 <- sabl_prop_mature_f_no70immature_95_01$length_cm
prop_sabl_f_no70immature_95_01 <- sabl_prop_mature_f_no70immature_95_01$prop_mature
n_sabl_f_no70immature_95_01 <- sabl_prop_mature_f_no70immature_95_01$n
fit.mat.glm.sabl_f_no70immature_95_01[1]
df.fit.mat.glm.sabl_f_no70immature_95_01 = as.data.frame(fit.mat.glm.sabl_f_no70immature_95_01[1])
A_glm.sabl_f_no70immature_95_01 = df.fit.mat.glm.sabl_f_no70immature_95_01$coefficients[1]
B_glm.sabl_f_no70immature_95_01 = df.fit.mat.glm.sabl_f_no70immature_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_no70immature_07_18 <- sabl_prop_mature_f_no70immature_07_18$length_cm
prop_sabl_f_no70immature_07_18 <- sabl_prop_mature_f_no70immature_07_18$prop_mature
n_sabl_f_no70immature_07_18 <- sabl_prop_mature_f_no70immature_07_18$n
fit.mat.glm.sabl_f_no70immature_07_18[1]
df.fit.mat.glm.sabl_f_no70immature_07_18 = as.data.frame(fit.mat.glm.sabl_f_no70immature_07_18[1])
A_glm.sabl_f_no70immature_07_18 = df.fit.mat.glm.sabl_f_no70immature_07_18$coefficients[1]
B_glm.sabl_f_no70immature_07_18 = df.fit.mat.glm.sabl_f_no70immature_07_18$coefficients[2]
```

```{r plot_sabl_allcodes_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_allcodes_no70immature_histcomp.eps"), height = 8, width = 8)

par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_no70immature_95_01, y = prop_sabl_f_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_no70immature_07_18, y = prop_sabl_f_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no70immature_95_01+(B_glm.sabl_f_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no70immature_07_18+(B_glm.sabl_f_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_no70immature_95_01 <- predict(fit.mat.glm.sabl_f_no70immature_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_no70immature_07_18 <- predict(fit.mat.glm.sabl_f_no70immature_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)


dev.off()

```



### All seasons, no 7s no 8s and no fish >= 70 cm that are immature
```{r get_parameters_sabl_no7no8_allseasons_no7no8_no70immature}
# 1995-2001 # 
bin_sabl_f_no7no8_no70immature_95_01 <- sabl_prop_mature_f_no7no8_no70immature_95_01$length_cm
prop_sabl_f_no7no8_no70immature_95_01 <- sabl_prop_mature_f_no7no8_no70immature_95_01$prop_mature
n_sabl_f_no7no8_no70immature_95_01 <- sabl_prop_mature_f_no7no8_no70immature_95_01$n
fit.mat.glm.sabl_no7no8_no70immature_95_01[1]
df.fit.mat.glm.sabl_no7no8_no70immature_95_01 = as.data.frame(fit.mat.glm.sabl_no7no8_no70immature_95_01[1])
A_glm.sabl_f_no7no8_no70immature_95_01 = df.fit.mat.glm.sabl_no7no8_no70immature_95_01$coefficients[1]
B_glm.sabl_f_no7no8_no70immature_95_01 = df.fit.mat.glm.sabl_no7no8_no70immature_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_no7no8_no70immature_07_18 <- sabl_prop_mature_f_no7no8_no70immature_07_18$length_cm
prop_sabl_f_no7no8_no70immature_07_18 <- sabl_prop_mature_f_no7no8_no70immature_07_18$prop_mature
n_sabl_f_no7no8_no70immature_07_18 <- sabl_prop_mature_f_no7no8_no70immature_07_18$n
fit.mat.glm.sabl_no7no8_no70immature_07_18[1]
df.fit.mat.glm.sabl_no7no8_no70immature_07_18 = as.data.frame(fit.mat.glm.sabl_no7no8_no70immature_07_18[1])
A_glm.sabl_f_no7no8_no70immature_07_18 = df.fit.mat.glm.sabl_no7no8_no70immature_07_18$coefficients[1]
B_glm.sabl_f_no7no8_no70immature_07_18 = df.fit.mat.glm.sabl_no7no8_no70immature_07_18$coefficients[2]
```

```{r plot_sabl_allseasons_no7no8_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_no7no8_no70immature_histcomp.eps"), height = 8, width = 8)

par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_no7no8_no70immature_95_01, y = prop_sabl_f_no7no8_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_no7no8_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_no7no8_no70immature_07_18, y = prop_sabl_f_no7no8_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_no7no8_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_no70immature_95_01+(B_glm.sabl_f_no7no8_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_no70immature_07_18+(B_glm.sabl_f_no7no8_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_no7no8_no70immature_95_01 <- predict(fit.mat.glm.sabl_no7no8_no70immature_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_no7no8_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_no7no8_no70immature_07_18 <- predict(fit.mat.glm.sabl_no7no8_no70immature_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_no7no8_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)


dev.off()

```




### Spawning season, all codes, no immature fish >= 70 cm
```{r get_parameters_sabl_allcodes_spwn_no70immature}
# 1995-2001 # 
bin_sabl_f_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_95_01$length_cm
prop_sabl_f_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_95_01$prop_mature
n_sabl_f_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_95_01$n
fit.mat.glm.sabl_spwn_no70immature_95_01[1]
df.fit.mat.glm.sabl_spwn_no70immature_95_01 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_95_01[1])
A_glm.sabl_f_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_95_01$coefficients[1]
B_glm.sabl_f_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_07_18$length_cm
prop_sabl_f_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_07_18$prop_mature
n_sabl_f_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_07_18$n
fit.mat.glm.sabl_spwn_no70immature_07_18[1]
df.fit.mat.glm.sabl_spwn_no70immature_07_18 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_07_18[1])
A_glm.sabl_f_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_07_18$coefficients[1]
B_glm.sabl_f_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_07_18$coefficients[2]
```

```{r plot_sabl_allcodes_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_allcodes_spwn_no70immature_histcomp.eps"), height = 8, width = 8)

par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_spwn_no70immature_95_01, y = prop_sabl_f_spwn_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_spwn_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_spwn_no70immature_07_18, y = prop_sabl_f_spwn_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_spwn_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_spwn_no70immature_95_01+(B_glm.sabl_f_spwn_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_spwn_no70immature_07_18+(B_glm.sabl_f_spwn_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_spwn_no70immature_95_01 <- predict(fit.mat.glm.sabl_spwn_no70immature_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_spwn_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_spwn_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_spwn_no70immature_07_18 <- predict(fit.mat.glm.sabl_spwn_no70immature_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_spwn_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_spwn_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)


dev.off()

```






### FIG 3: Spawning season, no 7s no 8s and no fish >= 70 cm that are immature
```{r get_parameters_sabl_no7no8_spwn_no70immature}
# 1995-2001 # 
bin_sabl_f_no7no8_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_no7no8_95_01$length_cm
prop_sabl_f_no7no8_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_no7no8_95_01$prop_mature
n_sabl_f_no7no8_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_no7no8_95_01$n
fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01[1]
df.fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01[1])
A_glm.sabl_f_no7no8_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01$coefficients[1]
B_glm.sabl_f_no7no8_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_no7no8_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_no7no8_07_18$length_cm
prop_sabl_f_no7no8_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_no7no8_07_18$prop_mature
n_sabl_f_no7no8_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_no7no8_07_18$n
fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18[1]
df.fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18[1])
A_glm.sabl_f_no7no8_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18$coefficients[1]
B_glm.sabl_f_no7no8_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18$coefficients[2]
```

```{r plot_sabl_allseasons_no7no8_comparisons}

### CREATE PLOT
setEPS()
postscript(here("figures", "historical_sensitivity_analysis", "sabl_no7no8_spwn_no70immature_histcomp.eps"), height = 8, width = 8)

par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_no7no8_spwn_no70immature_95_01, y = prop_sabl_f_no7no8_spwn_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_no7no8_spwn_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_no7no8_spwn_no70immature_07_18, y = prop_sabl_f_no7no8_spwn_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_no7no8_spwn_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_spwn_no70immature_95_01+(B_glm.sabl_f_no7no8_spwn_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_spwn_no70immature_07_18+(B_glm.sabl_f_no7no8_spwn_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_no7no8_spwn_no70immature_95_01 <- predict(fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_spwn_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_no7no8_spwn_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_no7no8_spwn_no70immature_07_18 <- predict(fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_spwn_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_no7no8_spwn_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)


dev.off()

```









# Plot - All combined as supplemental figure
Here we will run all code as a single chunk to preserve the par. This is the exact same code and produces the exact same plots as the "# Plot - each individually" section.



```{r historical_analysis_supplemental_figure}

# Set up figure
setEPS()
postscript(here("figures", "FigS1_v2.eps"), height = 16, width = 40)
par(mfrow = c(2,5), xpd=TRUE,mar = c("bottom" = 1, "left" = 1, "top" = 1, "right" = 1))

## Canary rockfish

### All seasons, all maturity codes
# ```{r get_parameters_for_plot_cnry_allseasons_allcodes}
# 1980-1984
bin_cnry_80_84 <- cnry_prop_mature_f_80_84$length_cm
prop_cnry_80_84 <- cnry_prop_mature_f_80_84$prop_mature
n_cnry_80_84 <- cnry_prop_mature_f_80_84$n
fit.mat.glm.cnry_80_84[1]
df.fit.mat.glm.cnry_80_84 = as.data.frame(fit.mat.glm.cnry_80_84[1])
A_glm.cnry_80_84 = df.fit.mat.glm.cnry_80_84$coefficients[1]
B_glm.cnry_80_84 = df.fit.mat.glm.cnry_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_10_18 <- cnry_prop_mature_f_10_18$length_cm
prop_cnry_10_18 <- cnry_prop_mature_f_10_18$prop_mature
n_cnry_10_18 <- cnry_prop_mature_f_10_18$n
fit.mat.glm.cnry_10_18[1]
df.fit.mat.glm.cnry_10_18 = as.data.frame(fit.mat.glm.cnry_10_18[1])
A_glm.cnry_10_18 = df.fit.mat.glm.cnry_10_18$coefficients[1]
B_glm.cnry_10_18 = df.fit.mat.glm.cnry_10_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_cnry_allseasons_allcodes_comparisons}

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_80_84, y = prop_cnry_80_84,cex=0.7*sqrt(n_cnry_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_10_18, y = prop_cnry_10_18,cex=0.7*sqrt(n_cnry_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_80_84+(B_glm.cnry_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_10_18+(B_glm.cnry_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_80_84 <- predict(fit.mat.glm.cnry_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_10_18 <- predict(fit.mat.glm.cnry_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

# Add lettering for figure
text(70, 1.08,  "(a)",cex = 4)

#<!-- ``` -->



### All seasons, no 7s and no 8s
# ```{r get_parameters_for_plot_cnry_allseasons_no7no8}
# 1980-1984
bin_cnry_no7no8_80_84 <- cnry_prop_mature_f_no7no8_80_84$length_cm
prop_cnry_no7no8_80_84 <- cnry_prop_mature_f_no7no8_80_84$prop_mature
n_cnry_no7no8_80_84 <- cnry_prop_mature_f_no7no8_80_84$n
fit.mat.glm.cnry_no7no8_80_84[1]
df.fit.mat.glm.cnry_no7no8_80_84 = as.data.frame(fit.mat.glm.cnry_no7no8_80_84[1])
A_glm.cnry_no7no8_80_84 = df.fit.mat.glm.cnry_no7no8_80_84$coefficients[1]
B_glm.cnry_no7no8_80_84 = df.fit.mat.glm.cnry_no7no8_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_no7no8_10_18 <- cnry_prop_mature_f_no7no8_10_18$length_cm
prop_cnry_no7no8_10_18 <- cnry_prop_mature_f_no7no8_10_18$prop_mature
n_cnry_no7no8_10_18 <- cnry_prop_mature_f_no7no8_10_18$n
fit.mat.glm.cnry_no7no8_10_18[1]
df.fit.mat.glm.cnry_no7no8_10_18 = as.data.frame(fit.mat.glm.cnry_no7no8_10_18[1])
A_glm.cnry_no7no8_10_18 = df.fit.mat.glm.cnry_no7no8_10_18$coefficients[1]
B_glm.cnry_no7no8_10_18 = df.fit.mat.glm.cnry_no7no8_10_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_cnry_allseasons_no7no8_comparisons}
# 
# ### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "cnry_allseasons_no7no8_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_no7no8_80_84, y = prop_cnry_no7no8_80_84,cex=0.7*sqrt(n_cnry_no7no8_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_no7no8_10_18, y = prop_cnry_no7no8_10_18,cex=0.7*sqrt(n_cnry_no7no8_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_no7no8_80_84+(B_glm.cnry_no7no8_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_no7no8_10_18+(B_glm.cnry_no7no8_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_no7no8_80_84 <- predict(fit.mat.glm.cnry_no7no8_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_no7no8_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_no7no8_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_no7no8_10_18 <- predict(fit.mat.glm.cnry_no7no8_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_no7no8_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_no7no8_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

# Add lettering for figure
text(70, 1.08,  "(b)",cex = 4)

# dev.off()


#<!-- ``` -->







### Spawning season, all maturity codes
# ```{r get_parameters_for_plot_cnry_allcodes}
# 1980-1984
bin_cnry_spwn_80_84 <- cnry_prop_mature_f_spwn_80_84$length_cm
prop_cnry_spwn_80_84 <- cnry_prop_mature_f_spwn_80_84$prop_mature
n_cnry_spwn_80_84 <- cnry_prop_mature_f_spwn_80_84$n
fit.mat.glm.cnry_spwn_80_84[1]
df.fit.mat.glm.cnry_spwn_80_84 = as.data.frame(fit.mat.glm.cnry_spwn_80_84[1])
A_glm.cnry_spwn_80_84 = df.fit.mat.glm.cnry_spwn_80_84$coefficients[1]
B_glm.cnry_spwn_80_84 = df.fit.mat.glm.cnry_spwn_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_spwn_10_18 <- cnry_prop_mature_f_spwn_10_18$length_cm
prop_cnry_spwn_10_18 <- cnry_prop_mature_f_spwn_10_18$prop_mature
n_cnry_spwn_10_18 <- cnry_prop_mature_f_spwn_10_18$n
fit.mat.glm.cnry_spwn_10_18[1]
df.fit.mat.glm.cnry_spwn_10_18 = as.data.frame(fit.mat.glm.cnry_spwn_10_18[1])
A_glm.cnry_spwn_10_18 = df.fit.mat.glm.cnry_spwn_10_18$coefficients[1]
B_glm.cnry_spwn_10_18 = df.fit.mat.glm.cnry_spwn_10_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_cnry_spwn_allcodes_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "cnry_spwn_allcodes_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_spwn_80_84, y = prop_cnry_spwn_80_84,cex=0.7*sqrt(n_cnry_spwn_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_spwn_10_18, y = prop_cnry_spwn_10_18,cex=0.7*sqrt(n_cnry_spwn_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_80_84+(B_glm.cnry_spwn_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_10_18+(B_glm.cnry_spwn_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_spwn_80_84 <- predict(fit.mat.glm.cnry_spwn_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_spwn_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_spwn_10_18 <- predict(fit.mat.glm.cnry_spwn_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_spwn_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              15, 20)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

# Add lettering for figure
text(70, 1.08,  "(c)",cex = 4)

# dev.off()

#<!-- ``` -->



### Spawning season, no 7s and no 8s
# ```{r get_parameters_for_plot_cnry_spwn_no7no8}
# 1980-1984
bin_cnry_spwn_no7no8_80_84 <- cnry_prop_mature_f_spwn_no7no8_80_84$length_cm
prop_cnry_spwn_no7no8_80_84 <- cnry_prop_mature_f_spwn_no7no8_80_84$prop_mature
n_cnry_spwn_no7no8_80_84 <- cnry_prop_mature_f_spwn_no7no8_80_84$n
fit.mat.glm.cnry_spwn_no7no8_80_84[1]
df.fit.mat.glm.cnry_spwn_no7no8_80_84 = as.data.frame(fit.mat.glm.cnry_spwn_no7no8_80_84[1])
A_glm.cnry_spwn_no7no8_80_84 = df.fit.mat.glm.cnry_spwn_no7no8_80_84$coefficients[1]
B_glm.cnry_spwn_no7no8_80_84 = df.fit.mat.glm.cnry_spwn_no7no8_80_84$coefficients[2]

# 2010-2018 # 
bin_cnry_spwn_no7no8_10_18 <- cnry_prop_mature_f_spwn_no7no8_10_18$length_cm
prop_cnry_spwn_no7no8_10_18 <- cnry_prop_mature_f_spwn_no7no8_10_18$prop_mature
n_cnry_spwn_no7no8_10_18 <- cnry_prop_mature_f_spwn_no7no8_10_18$n
fit.mat.glm.cnry_spwn_no7no8_10_18[1]
df.fit.mat.glm.cnry_spwn_no7no8_10_18 = as.data.frame(fit.mat.glm.cnry_spwn_no7no8_10_18[1])
A_glm.cnry_spwn_no7no8_10_18 = df.fit.mat.glm.cnry_spwn_no7no8_10_18$coefficients[1]
B_glm.cnry_spwn_no7no8_10_18 = df.fit.mat.glm.cnry_spwn_no7no8_10_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_cnry_no7no8_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "cnry_spwn_no7no8_histcomp.eps"), height = 8, width = 8)

par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(20,70),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_cnry_spwn_no7no8_80_84, y = prop_cnry_spwn_no7no8_80_84,cex=0.7*sqrt(n_cnry_spwn_no7no8_80_84), pch=16, col = "#f4a582")
points(x = bin_cnry_spwn_no7no8_10_18, y = prop_cnry_spwn_no7no8_10_18,cex=0.7*sqrt(n_cnry_spwn_no7no8_10_18), pch=16, col = "#92c5de")


lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_no7no8_80_84+(B_glm.cnry_spwn_no7no8_80_84*(20:70)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 1#####
lines(20:70, 1/(1+(exp(-(A_glm.cnry_spwn_no7no8_10_18+(B_glm.cnry_spwn_no7no8_10_18*(20:70)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(20:70))
predat_cnry_spwn_no7no8_80_84 <- predict(fit.mat.glm.cnry_spwn_no7no8_80_84,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_no7no8_80_84, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_cnry_spwn_no7no8_80_84, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_cnry_spwn_no7no8_10_18 <- predict(fit.mat.glm.cnry_spwn_no7no8_10_18,newdata=plotdat, se.fit=TRUE)
with(predat_cnry_spwn_no7no8_10_18, lines(20:70,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_cnry_spwn_no7no8_10_18, lines(20:70,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


# L50 line #
segments(18,0.5,72,0.5,lty=5)

#Legend
legend.a <- c(5, 10,     
              15, 20)

legend.cex <- 0.7*sqrt(legend.a)

legend(20 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(22, 1.095, "N",cex = 1.7)


legend(54,0.1, legend=c("1980-1984","2010-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")

# Add lettering for figure
text(70, 1.08,  "(d)",cex = 4)

# dev.off()

#<!-- ``` -->



### blank plot as placeholder so that all canary are in top row and all sablefish in bottom row
plot.new()


## Sablefish

### All seasons, all codes, all fish
# ```{r get_parameters_for_plot_sabl_allcodes_allseasons_allfish}
# 1995-2001 # 
bin_sabl_f_95_01 <- sabl_prop_mature_f_95_01$length_cm
prop_sabl_f_95_01 <- sabl_prop_mature_f_95_01$prop_mature
n_sabl_f_95_01 <- sabl_prop_mature_f_95_01$n
fit.mat.glm.sabl_f_95_01[1]
df.fit.mat.glm.sabl_f_95_01 = as.data.frame(fit.mat.glm.sabl_f_95_01[1])
A_glm.sabl_f_95_01 = df.fit.mat.glm.sabl_f_95_01$coefficients[1]
B_glm.sabl_f_95_01 = df.fit.mat.glm.sabl_f_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_07_18 <- sabl_prop_mature_f_07_18$length_cm
prop_sabl_f_07_18 <- sabl_prop_mature_f_07_18$prop_mature
n_sabl_f_07_18 <- sabl_prop_mature_f_07_18$n
fit.mat.glm.sabl_f_07_18[1]
df.fit.mat.glm.sabl_f_07_18 = as.data.frame(fit.mat.glm.sabl_f_07_18[1])
A_glm.sabl_f_07_18 = df.fit.mat.glm.sabl_f_07_18$coefficients[1]
B_glm.sabl_f_07_18 = df.fit.mat.glm.sabl_f_07_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_sabl_allcodes_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_allcodes_allfish_histcomp.eps"), height = 8, width = 8)

# par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_95_01, y = prop_sabl_f_95_01,cex=0.7*sqrt(n_sabl_f_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_07_18, y = prop_sabl_f_07_18,cex=0.7*sqrt(n_sabl_f_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_95_01+(B_glm.sabl_f_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_07_18+(B_glm.sabl_f_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_95_01 <- predict(fit.mat.glm.sabl_f_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_07_18 <- predict(fit.mat.glm.sabl_f_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)

# Add lettering for figure
text(82, 1.08, "(e)",cex = 4)

# dev.off()

#<!-- ``` -->


### All seasons, all codes, no immature fish >= 70 cm
# ```{r get_parameters_sabl_allcodes_allseasons_no70immature}
# 1995-2001 # 
bin_sabl_f_no70immature_95_01 <- sabl_prop_mature_f_no70immature_95_01$length_cm
prop_sabl_f_no70immature_95_01 <- sabl_prop_mature_f_no70immature_95_01$prop_mature
n_sabl_f_no70immature_95_01 <- sabl_prop_mature_f_no70immature_95_01$n
fit.mat.glm.sabl_f_no70immature_95_01[1]
df.fit.mat.glm.sabl_f_no70immature_95_01 = as.data.frame(fit.mat.glm.sabl_f_no70immature_95_01[1])
A_glm.sabl_f_no70immature_95_01 = df.fit.mat.glm.sabl_f_no70immature_95_01$coefficients[1]
B_glm.sabl_f_no70immature_95_01 = df.fit.mat.glm.sabl_f_no70immature_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_no70immature_07_18 <- sabl_prop_mature_f_no70immature_07_18$length_cm
prop_sabl_f_no70immature_07_18 <- sabl_prop_mature_f_no70immature_07_18$prop_mature
n_sabl_f_no70immature_07_18 <- sabl_prop_mature_f_no70immature_07_18$n
fit.mat.glm.sabl_f_no70immature_07_18[1]
df.fit.mat.glm.sabl_f_no70immature_07_18 = as.data.frame(fit.mat.glm.sabl_f_no70immature_07_18[1])
A_glm.sabl_f_no70immature_07_18 = df.fit.mat.glm.sabl_f_no70immature_07_18$coefficients[1]
B_glm.sabl_f_no70immature_07_18 = df.fit.mat.glm.sabl_f_no70immature_07_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_sabl_allcodes_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_allcodes_no70immature_histcomp.eps"), height = 8, width = 8)

# par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_no70immature_95_01, y = prop_sabl_f_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_no70immature_07_18, y = prop_sabl_f_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no70immature_95_01+(B_glm.sabl_f_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no70immature_07_18+(B_glm.sabl_f_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_no70immature_95_01 <- predict(fit.mat.glm.sabl_f_no70immature_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_no70immature_07_18 <- predict(fit.mat.glm.sabl_f_no70immature_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)

# Add lettering for figure
text(82, 1.08, "(f)",cex = 4)

# dev.off()

#<!-- ``` -->



### All seasons, no 7s no 8s and no fish >= 70 cm that are immature
# ```{r get_parameters_sabl_no7no8_allseasons_no7no8_no70immature}
# 1995-2001 # 
bin_sabl_f_no7no8_no70immature_95_01 <- sabl_prop_mature_f_no7no8_no70immature_95_01$length_cm
prop_sabl_f_no7no8_no70immature_95_01 <- sabl_prop_mature_f_no7no8_no70immature_95_01$prop_mature
n_sabl_f_no7no8_no70immature_95_01 <- sabl_prop_mature_f_no7no8_no70immature_95_01$n
fit.mat.glm.sabl_no7no8_no70immature_95_01[1]
df.fit.mat.glm.sabl_no7no8_no70immature_95_01 = as.data.frame(fit.mat.glm.sabl_no7no8_no70immature_95_01[1])
A_glm.sabl_f_no7no8_no70immature_95_01 = df.fit.mat.glm.sabl_no7no8_no70immature_95_01$coefficients[1]
B_glm.sabl_f_no7no8_no70immature_95_01 = df.fit.mat.glm.sabl_no7no8_no70immature_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_no7no8_no70immature_07_18 <- sabl_prop_mature_f_no7no8_no70immature_07_18$length_cm
prop_sabl_f_no7no8_no70immature_07_18 <- sabl_prop_mature_f_no7no8_no70immature_07_18$prop_mature
n_sabl_f_no7no8_no70immature_07_18 <- sabl_prop_mature_f_no7no8_no70immature_07_18$n
fit.mat.glm.sabl_no7no8_no70immature_07_18[1]
df.fit.mat.glm.sabl_no7no8_no70immature_07_18 = as.data.frame(fit.mat.glm.sabl_no7no8_no70immature_07_18[1])
A_glm.sabl_f_no7no8_no70immature_07_18 = df.fit.mat.glm.sabl_no7no8_no70immature_07_18$coefficients[1]
B_glm.sabl_f_no7no8_no70immature_07_18 = df.fit.mat.glm.sabl_no7no8_no70immature_07_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_sabl_allseasons_no7no8_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_no7no8_no70immature_histcomp.eps"), height = 8, width = 8)

# par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_no7no8_no70immature_95_01, y = prop_sabl_f_no7no8_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_no7no8_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_no7no8_no70immature_07_18, y = prop_sabl_f_no7no8_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_no7no8_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_no70immature_95_01+(B_glm.sabl_f_no7no8_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_no70immature_07_18+(B_glm.sabl_f_no7no8_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_no7no8_no70immature_95_01 <- predict(fit.mat.glm.sabl_no7no8_no70immature_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_no7no8_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_no7no8_no70immature_07_18 <- predict(fit.mat.glm.sabl_no7no8_no70immature_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_no7no8_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)

# Add lettering for figure
text(82, 1.08, "(g)",cex = 4)

# dev.off()

#<!-- ``` -->




### Spawning season, all codes, no immature fish >= 70 cm
# ```{r get_parameters_sabl_allcodes_spwn_no70immature}
# 1995-2001 # 
bin_sabl_f_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_95_01$length_cm
prop_sabl_f_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_95_01$prop_mature
n_sabl_f_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_95_01$n
fit.mat.glm.sabl_spwn_no70immature_95_01[1]
df.fit.mat.glm.sabl_spwn_no70immature_95_01 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_95_01[1])
A_glm.sabl_f_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_95_01$coefficients[1]
B_glm.sabl_f_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_07_18$length_cm
prop_sabl_f_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_07_18$prop_mature
n_sabl_f_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_07_18$n
fit.mat.glm.sabl_spwn_no70immature_07_18[1]
df.fit.mat.glm.sabl_spwn_no70immature_07_18 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_07_18[1])
A_glm.sabl_f_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_07_18$coefficients[1]
B_glm.sabl_f_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_07_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_sabl_allcodes_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "sabl_allseasons_allcodes_spwn_no70immature_histcomp.eps"), height = 8, width = 8)

# par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_spwn_no70immature_95_01, y = prop_sabl_f_spwn_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_spwn_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_spwn_no70immature_07_18, y = prop_sabl_f_spwn_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_spwn_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_spwn_no70immature_95_01+(B_glm.sabl_f_spwn_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_spwn_no70immature_07_18+(B_glm.sabl_f_spwn_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_spwn_no70immature_95_01 <- predict(fit.mat.glm.sabl_spwn_no70immature_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_spwn_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_spwn_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_spwn_no70immature_07_18 <- predict(fit.mat.glm.sabl_spwn_no70immature_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_spwn_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_spwn_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)

# Add lettering for figure
text(82, 1.08, "(h)",cex = 4)

# dev.off()

#<!-- ``` -->






### Spawning season, no 7s no 8s and no fish >= 70 cm that are immature
# ```{r get_parameters_sabl_no7no8_spwn_no70immature}
# 1995-2001 # 
bin_sabl_f_no7no8_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_no7no8_95_01$length_cm
prop_sabl_f_no7no8_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_no7no8_95_01$prop_mature
n_sabl_f_no7no8_spwn_no70immature_95_01 <- sabl_prop_mature_f_spwn_no70immature_no7no8_95_01$n
fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01[1]
df.fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01[1])
A_glm.sabl_f_no7no8_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01$coefficients[1]
B_glm.sabl_f_no7no8_spwn_no70immature_95_01 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01$coefficients[2]

# 2007-2018 # 
bin_sabl_f_no7no8_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_no7no8_07_18$length_cm
prop_sabl_f_no7no8_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_no7no8_07_18$prop_mature
n_sabl_f_no7no8_spwn_no70immature_07_18 <- sabl_prop_mature_f_spwn_no70immature_no7no8_07_18$n
fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18[1]
df.fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18 = as.data.frame(fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18[1])
A_glm.sabl_f_no7no8_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18$coefficients[1]
B_glm.sabl_f_no7no8_spwn_no70immature_07_18 = df.fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18$coefficients[2]
#<!-- ``` -->

# ```{r plot_sabl_allseasons_no7no8_comparisons}

### CREATE PLOT
# setEPS()
# postscript(here("figures", "historical_sensitivity_analysis", "sabl_no7no8_spwn_no70immature_histcomp.eps"), height = 8, width = 8)

# par(mfrow=c(1,1))
par(xpd=TRUE,mar = c("bottom" = 5, "left" = 5, "top" = 1, "right" = 1))
plot(0, type ='n', xlim=c(30,85),ylim=c(-0.01,1.1),xlab="Length (cm)",ylab="Proportion mature", cex.lab = 1.6, cex.axis = 1.3)

# points(x = bin_m.2, y = prop_m.2,cex=0.7*sqrt(n_m.2), pch=16, col = rgb(0,0,1,0.2))
points(x = bin_sabl_f_no7no8_spwn_no70immature_95_01, y = prop_sabl_f_no7no8_spwn_no70immature_95_01,cex=0.7*sqrt(n_sabl_f_no7no8_spwn_no70immature_95_01), pch=16, col = "#f4a582")
points(x = bin_sabl_f_no7no8_spwn_no70immature_07_18, y = prop_sabl_f_no7no8_spwn_no70immature_07_18,cex=0.7*sqrt(n_sabl_f_no7no8_spwn_no70immature_07_18), pch=16, col = "#92c5de")


lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_spwn_no70immature_95_01+(B_glm.sabl_f_no7no8_spwn_no70immature_95_01*(30:83)))))), type = "l", col='#b2182b', pch = 19, lty =1,lwd = 3)####Time Period 2#####
lines(30:83, 1/(1+(exp(-(A_glm.sabl_f_no7no8_spwn_no70immature_07_18+(B_glm.sabl_f_no7no8_spwn_no70immature_07_18*(30:83)))))), type = "l", col='#2166ac', pch = 19, lty =1,lwd = 3)####Time Period 2#####

# GLM Confidence Bands #

plotdat <- data.frame(length=(30:83))
predat_sabl_f_no7no8_spwn_no70immature_95_01 <- predict(fit.mat.glm.sabl_spwn_no70immature_no7no8_95_01,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_spwn_no70immature_95_01, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#b2182b"))
with(predat_sabl_f_no7no8_spwn_no70immature_95_01, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#b2182b"))

predat_sabl_f_no7no8_spwn_no70immature_07_18 <- predict(fit.mat.glm.sabl_spwn_no70immature_no7no8_07_18,newdata=plotdat, se.fit=TRUE)
with(predat_sabl_f_no7no8_spwn_no70immature_07_18, lines(30:83,exp(fit+1.96*se.fit)/(1+exp(fit+1.96*se.fit)),lty=2,col="#2166ac"))
with(predat_sabl_f_no7no8_spwn_no70immature_07_18, lines(30:83,exp(fit-1.96*se.fit)/(1+exp(fit-1.96*se.fit)),lty=2,col="#2166ac"))


#Legend
legend.a <- c(10, 20, 30)

legend.cex <- 0.7*sqrt(legend.a)

legend(30 ,1.1,legend=legend.a,pch=19,col="gray20",
       cex = 1.5, pt.cex=legend.cex,ncol=1,bty='n', y.intersp = 1.3)
text(32, 1.095, "N",cex = 1.7)

# legend(30,1.01,legend="20",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(20),ncol=1,bty='n')
# legend(30,0.95,legend="30",pch=19,col="gray20",cex = 1, pt.cex=0.7*sqrt(30),ncol=1,bty='n')

legend(67.5,0.1, legend=c("1995-2001","2007-2018"), col=c("#b2182b", "#2166ac"), lwd=c(3,3),
       lty= c(1,1,1), cex=1.5, bty="n")


# # L50 line intercept #
segments(28,0.5,87,0.5,lty=5)


# Add lettering for figure
text(82, 1.08, "(i)",cex = 4)

# END OF COMBINED PLOT
dev.off()

```

